

with salesforce_opportunities as (
    select
        id,
        name,
        type,
        iswon,
        fiscal,
        mils__c,
        ownerid,
        rate__c,
        term__c,
        team__c,
        source__c,
        marketing_generator__c,
        isclosed,
        notes__c,
        accountid,
        csdate__c,
        closedate,
        driver__c,
        meters__c,
        points__c,
        stagename,
        status__c,
        channel__c,
        leadsource,
        manager__c,
        re_sold__c,
        renewed__c,
        createddate,
        residual__c,
        sp_rt_id__c,
        subagent__c,
        supplier__c,
        commodity__c,
        rate_type__c,
        sp_points__c,
        sold_date__c,
        broker_fee__c,
        cancel_fee__c,
        usage_type__c,
        cancel_date__c,
        dl_rate_gas__c,
        dl_owner_alias__c,
        dl_term_gas__c,
        lost_reason__c,
        meter_usage__c,
        owner_title__c,
        real_points__c,
        total_usage__c,
        dl_start_gas__c,
        dl_usage_gas__c,
        do_not_renew__c,
        renewal_date__c,
        sales_person__c,
        total_points__c,
        utility_text__c,
        sales_manager__c,
        supplier_text__c,
        agent_takeback__c,
        canceled_usage__c,
        commodity_text__c,
        contract_signer__c,
        cancelled_points__c,
        supplier_credits__c,
        commission_matrix__c,
        contract_end_date__c,
        broker_fee_rounded__c,
        commission_percent__c,
        last_activity_note__c,
        confirmation_number__c,
        contract_start_date__c,
        contract_signer_email__c,
        contract_signer_phone_email__c
--        contract_signer_facilitator__c
    from "integrity-db"."prod_dbt-base"."salesforce_opportunity_base"
),

salesforce_contacts as (
    select
        id as contact_id,
        name as contact_name,
        email as contact_email,
        phone as contact_phone,
        mobilephone as contact_mobilephone,
        main_phone__c as contact_mainphone,
        title as contact_title,
        createddate as contact_createddate,
        mailingcity as contact_mailingcity,
        mailingstate as contact_mailingstate,
        mailingstatecode as contact_mailingstatecode,
        mailingcountry as contact_mailingcountry,
        accountid as contact_accountid,
        rep_last_first__c as contact_rep_last_first,
        customer_account_number__c as contact_customer_account_number,
        contract_signer_phone_email__c as contact_contract_signer_phone_email
    from "integrity-db"."prod_dbt-base"."salesforce_contact_base"
),

salesforce_leads as (
    select
        id as lead_id,
        city as lead_city,
        name as lead_name,
        email as lead_email,
        phone as lead_phone,
        state as lead_state,
        title as lead_title,
        status as lead_status,
        street as lead_street,
        company as lead_company,
        country as lead_country,
        firstname as lead_firstname,
        lastname as lead_lastname,
        source__c as lead_source,
        channel__c as lead_channel,
        leadsource as lead_leadsource,
        postalcode as lead_postalcode,
        createddate as lead_createddate,
        isconverted as lead_isconverted,
        commodity__c as lead_commodity,
        converteddate as lead_converteddate,
        lastactivitydate as lead_lastactivitydate,
        convertedaccountid as lead_convertedaccountid,
        convertedcontactid as lead_convertedcontactid,
        average_bill_amount__c as lead_average_bill_amount,
        convertedopportunityid as lead_convertedopportunityid,
        marketing_generator__c as lead_marketing_generator,
        new_ready_to_work_date__c as lead_new_ready_to_work_date
    from "integrity-db"."prod_dbt-base"."salesforce_lead_base"
)

select
*
from salesforce_opportunities as o
left join salesforce_leads as l on l.lead_convertedcontactid = o.contract_signer__c
left join salesforce_contacts as c on c.contact_id = o.contract_signer__c