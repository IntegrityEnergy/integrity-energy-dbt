{"metadata": {"dbt_schema_version": "https://schemas.getdbt.com/dbt/run-results/v6.json", "dbt_version": "1.9.0b2", "generated_at": "2025-01-02T23:22:13.225236Z", "invocation_id": "f7e6f390-8acd-4792-b1dd-13b8df828ed1", "env": {}}, "results": [{"status": "success", "timing": [{"name": "compile", "started_at": "2025-01-02T23:21:04.811678Z", "completed_at": "2025-01-02T23:21:04.848867Z"}, {"name": "execute", "started_at": "2025-01-02T23:21:04.861606Z", "completed_at": "2025-01-02T23:21:10.230167Z"}], "thread_id": "Thread-4 (worker)", "execution_time": 5.499060869216919, "adapter_response": {"_message": "SUCCESS", "rows_affected": -1}, "message": "SUCCESS", "failures": null, "unique_id": "model.integrity_energy_dbt.hubspot_daily_base", "compiled": true, "compiled_code": "\n\nwith hubspot_daily as (\n    SELECT\n        (TIMESTAMP 'epoch' + created / 1000 * INTERVAL '1 second')::DATE AS converted_date,\n        type\n    FROM \"integrity-db\".\"hubspot\".\"email_events\"\n)\n\nSELECT\n    converted_date,\n    sum(case when type = 'SENT' then 1 else 0 end) as sent_emails,\n    sum(case when type = 'OPEN' then 1 else 0 end) as opened_emails,\n    sum(case when type = 'CLICK' then 1 else 0 end) as clicks,\n    sum(case when type = 'BOUNCE' then 1 else 0 end) as bounces,\n    sum(case when type = 'SPAMREPORT' then 1 else 0 end) as spam_reports\nfrom hubspot_daily\ngroup by converted_date", "relation_name": "\"integrity-db\".\"prod_dbt-base\".\"hubspot_daily_base\"", "batch_results": null}, {"status": "success", "timing": [{"name": "compile", "started_at": "2025-01-02T23:21:04.808679Z", "completed_at": "2025-01-02T23:21:04.844364Z"}, {"name": "execute", "started_at": "2025-01-02T23:21:04.856381Z", "completed_at": "2025-01-02T23:21:11.806266Z"}], "thread_id": "Thread-3 (worker)", "execution_time": 7.076072931289673, "adapter_response": {"_message": "SUCCESS", "rows_affected": -1}, "message": "SUCCESS", "failures": null, "unique_id": "model.integrity_energy_dbt.google_ads_daily_base", "compiled": true, "compiled_code": "\n\nselect\n    DATE(_data_date) as activity_date, \n    metrics_impressions as googleads_impressions,\n    metrics_cost_micros  as googleads_cost, \n    metrics_clicks as googleads_clicks\nfrom \"integrity-db\".\"google_ads\".\"ads_campaignbasicstats_7446470445\"", "relation_name": "\"integrity-db\".\"prod_dbt-base\".\"google_ads_daily_base\"", "batch_results": null}, {"status": "success", "timing": [{"name": "compile", "started_at": "2025-01-02T23:21:04.805650Z", "completed_at": "2025-01-02T23:21:04.814681Z"}, {"name": "execute", "started_at": "2025-01-02T23:21:04.845364Z", "completed_at": "2025-01-02T23:21:13.330693Z"}], "thread_id": "Thread-2 (worker)", "execution_time": 8.605507373809814, "adapter_response": {"_message": "SUCCESS", "rows_affected": -1}, "message": "SUCCESS", "failures": null, "unique_id": "model.integrity_energy_dbt.facebook_daily_base", "compiled": true, "compiled_code": "\n\nselect\n    date_start, \n    sum(impressions) as facebook_impressions,\n    sum(reach) as facebook_reach,\n    sum(spend) as facebook_spend, \n    sum(clicks) as facebook_clicks,\n    sum(unique_clicks) as facebook_unique_clicks\nfrom \"integrity-db\".\"facebook\".\"ads_insights\"\ngroup by date_start", "relation_name": "\"integrity-db\".\"prod_dbt-base\".\"facebook_daily_base\"", "batch_results": null}, {"status": "success", "timing": [{"name": "compile", "started_at": "2025-01-02T23:21:04.800652Z", "completed_at": "2025-01-02T23:21:04.814681Z"}, {"name": "execute", "started_at": "2025-01-02T23:21:04.815815Z", "completed_at": "2025-01-02T23:21:15.315413Z"}], "thread_id": "Thread-1 (worker)", "execution_time": 11.070219039916992, "adapter_response": {"_message": "SUCCESS", "rows_affected": -1}, "message": "SUCCESS", "failures": null, "unique_id": "model.integrity_energy_dbt.bing_ads_daily_base", "compiled": true, "compiled_code": "\n\nselect\n    spend,\n    impressions,\n    clicks,\n    timeperiod,\n    adgroupname,\n    campaignname\nfrom \"integrity-db\".\"bing_ads\".\"ad_performance_report_daily\"", "relation_name": "\"integrity-db\".\"prod_dbt-base\".\"bing_ads_daily_base\"", "batch_results": null}, {"status": "success", "timing": [{"name": "compile", "started_at": "2025-01-02T23:21:11.879090Z", "completed_at": "2025-01-02T23:21:11.882075Z"}, {"name": "execute", "started_at": "2025-01-02T23:21:11.883076Z", "completed_at": "2025-01-02T23:21:15.786404Z"}], "thread_id": "Thread-3 (worker)", "execution_time": 3.9901294708251953, "adapter_response": {"_message": "SUCCESS", "rows_affected": -1}, "message": "SUCCESS", "failures": null, "unique_id": "model.integrity_energy_dbt.salesforce_account_base", "compiled": true, "compiled_code": "\n\nselect\n    id,\n    name,\n    type,\n    phone,\n    industry,\n    billingcity,\n    billingcountry,\n    billingcountrycode,\n    billingpostalcode,\n    billingstreet,\n    main_phone__c\n    --utility_company__c\nfrom \"integrity-db\".\"salesforce\".\"account\"", "relation_name": "\"integrity-db\".\"prod_dbt-base\".\"salesforce_account_base\"", "batch_results": null}, {"status": "success", "timing": [{"name": "compile", "started_at": "2025-01-02T23:21:10.302292Z", "completed_at": "2025-01-02T23:21:10.306291Z"}, {"name": "execute", "started_at": "2025-01-02T23:21:10.307296Z", "completed_at": "2025-01-02T23:21:18.095878Z"}], "thread_id": "Thread-4 (worker)", "execution_time": 8.366058111190796, "adapter_response": {"_message": "SUCCESS", "rows_affected": -1}, "message": "SUCCESS", "failures": null, "unique_id": "model.integrity_energy_dbt.marketing_cost_base", "compiled": true, "compiled_code": "\n\nselect\n    team,\n    CAST(month as date) as month,\n    CAST(REPLACE(hom_cost, ',', '') as decimal(10,2)) as hom_cost,\n    CAST(REPLACE(ipr_cost, ',', '')  as decimal(10,2)) as ipr_cost,\n    CAST(REPLACE(copywriter, ',', '') as decimal(10,2)) as copywriter,\n    CAST(REPLACE(dango_costs, ',', '') as decimal(10,2)) as dango_costs,\n    CAST(REPLACE(designer_costs, ',', '') as decimal(10,2)) as designer_costs,\n    CAST(REPLACE(paid_lead_cost, ',', '') as decimal(10,2)) as paid_lead_cost,\n    CAST(REPLACE(data_contractor, ',', '') as decimal(10,2)) as data_contractor,\n    CAST(REPLACE(seo_lead_salary, ',', '') as decimal(10,2)) as seo_lead_salary,\n    CAST(REPLACE(contractor_costs, ',', '') as decimal(10,2)) as contractor_costs,\n    CAST(REPLACE(paid_agency_cost, ',', '') as decimal(10,2)) as paid_agency_cost,\n    CAST(REPLACE(paid_support_cost, ',', '') as decimal(10,2)) as paid_support_cost,\n    CAST(REPLACE(project_management, ',', '') as decimal(10,2)) as project_management,\n    CAST(REPLACE(crowd_content_costs, ',', '') as decimal(10,2)) as crowd_content_costs,\n    CAST(REPLACE(email_contractor_costs, ',', '') as decimal(10,2)) as email_contractor_costs,\n    CAST(REPLACE(hubspot_contractor_costs, ',', '') as decimal(10,2)) as hubspot_contractor_costs\nfrom \"integrity-db\".\"google_sheets\".\"monthly_cost\"", "relation_name": "\"integrity-db\".\"prod_dbt-base\".\"marketing_cost_base\"", "batch_results": null}, {"status": "success", "timing": [{"name": "compile", "started_at": "2025-01-02T23:21:13.407364Z", "completed_at": "2025-01-02T23:21:13.416069Z"}, {"name": "execute", "started_at": "2025-01-02T23:21:13.416069Z", "completed_at": "2025-01-02T23:21:18.598359Z"}], "thread_id": "Thread-2 (worker)", "execution_time": 5.270344972610474, "adapter_response": {"_message": "SUCCESS", "rows_affected": -1}, "message": "SUCCESS", "failures": null, "unique_id": "model.integrity_energy_dbt.salesforce_contact_base", "compiled": true, "compiled_code": "\n\nWITH base AS (\n\n    SELECT\n        id,\n        name,\n        LOWER(TRIM(email)) AS email,\n        REGEXP_REPLACE(phone, '[- ]', '') AS phone,\n        REGEXP_REPLACE(mobilephone, '[- ', '') AS mobilephone,\n        REGEXP_REPLACE(main_phone__c, '[- ]', '') AS main_phone__c,\n        title,\n        createddate,\n        mailingcity,\n        mailingstate,\n        mailingstatecode,\n        mailingcountry,\n        accountid,\n        rep_last_first__c,\n        customer_account_number__c,\n        contract_signer_phone_email__c,\n        ROW_NUMBER() OVER (\n          PARTITION BY\n            REGEXP_REPLACE(phone, '[- ]', ''), -- Remove spaces and hyphens from phone numbers\n            LOWER(TRIM(REGEXP_REPLACE(email, '[- ]', ''))), -- Normalize email by converting to lowercase\n            LOWER(TRIM(name)) -- Normalize name by converting to lowercase\n          ORDER BY\n            COALESCE(lastactivitydate, createddate) DESC -- Order by last activity date or created date\n        ) AS rn\n    FROM\n        \"integrity-db\".\"salesforce\".\"contact\"\n\n)\n\nSELECT\n    id,\n    name,\n    email,\n    phone,\n    mobilephone,\n    main_phone__c,\n    title,\n    createddate,\n    mailingcity,\n    mailingstate,\n    mailingstatecode,\n    mailingcountry,\n    accountid,\n    rep_last_first__c,\n    customer_account_number__c,\n    contract_signer_phone_email__c\nFROM\n    base\nWHERE\n    rn = 1", "relation_name": "\"integrity-db\".\"prod_dbt-base\".\"salesforce_contact_base\"", "batch_results": null}, {"status": "success", "timing": [{"name": "compile", "started_at": "2025-01-02T23:21:15.879573Z", "completed_at": "2025-01-02T23:21:15.882572Z"}, {"name": "execute", "started_at": "2025-01-02T23:21:15.887570Z", "completed_at": "2025-01-02T23:21:20.379921Z"}], "thread_id": "Thread-3 (worker)", "execution_time": 4.581018924713135, "adapter_response": {"_message": "SUCCESS", "rows_affected": -1}, "message": "SUCCESS", "failures": null, "unique_id": "model.integrity_energy_dbt.salesforce_meter_number_base", "compiled": true, "compiled_code": "\n\nselect\n    id,\n    name,\n    city__c,\n    state__c,\n    street__c,\n    zip_code__c,\n    mils__c,\n    commodity__c,\n    createddate,\n    service_address__c,\n    status__c,\n    account__c,\n    dl_account__c,\n    account_number__c\nfrom \"integrity-db\".\"salesforce\".\"meter_number__c\"", "relation_name": "\"integrity-db\".\"prod_dbt-base\".\"salesforce_meter_number_base\"", "batch_results": null}, {"status": "success", "timing": [{"name": "compile", "started_at": "2025-01-02T23:21:18.699613Z", "completed_at": "2025-01-02T23:21:18.704130Z"}, {"name": "execute", "started_at": "2025-01-02T23:21:18.704130Z", "completed_at": "2025-01-02T23:21:24.803515Z"}], "thread_id": "Thread-2 (worker)", "execution_time": 6.6392858028411865, "adapter_response": {"_message": "SUCCESS", "rows_affected": -1}, "message": "SUCCESS", "failures": null, "unique_id": "model.integrity_energy_dbt.utility_lead_base", "compiled": true, "compiled_code": "\n\nWITH utilitylead_base AS (\n\n    SELECT\n        companyname,\n        serviceaddress,\n        servicecity,\n        servicestate,\n        servicezip,\n        utility,\n        accountnumber,\n        annualusage,\n        ratecode,\n        ROW_NUMBER() OVER (\n          PARTITION BY\n            companyname, serviceaddress, utility, servicecity, servicestate, ratecode\n          ORDER BY\n            _airbyte_extracted_at DESC\n        ) AS rn\n    FROM\n        \"integrity-db\".\"utility_leads\".\"utilitylead\"\n\n),\n\nenriched_base AS (\n\n    SELECT\n        \"eru lastname\" as lastname,\n        \"eru firstname\" as firstname,\n        \"eru titledesc\" as title,\n        \"be telephone number10\" as phone,\n        \"bee email addr80\" as email,\n        companyname,\n        serviceaddress,\n        utility,\n        servicecity,\n        servicestate,\n        ratecode\n    FROM\n        \"integrity-db\".\"utility_leads\".\"enriched\"\n\n)\n\n\nselect\n        u.companyname,\n        u.serviceaddress,\n        u.servicecity,\n        u.servicestate,\n        u.servicezip,\n        u.utility,\n        u.accountnumber,\n        u.annualusage,\n        u.ratecode,\n        REGEXP_REPLACE(e.lastname, '[^a-zA-Z]', '') AS lastname,\n        REGEXP_REPLACE(e.firstname, '[^a-zA-Z]', '') AS firstname,\n        e.title,\n        REGEXP_REPLACE(e.phone, '[- ]', '') AS phone,\n        LOWER(TRIM(e.email)) AS email,\nFROM\n    utilitylead_base AS u\n    LEFT JOIN enriched_base AS e\n        ON u.companyname = e.companyname\n            AND u.serviceaddress = e.serviceaddress\n            AND u.utility = e.utility\n            AND u.servicecity = e.servicecity\n            AND u.servicestate = e.servicestate\n            AND u.ratecode = e.ratecode\nWHERE\n    u.rn = 1\nGROUP BY\n    1,2,3,4,5,6,7,8,9,10,11,12,13,14", "relation_name": "\"integrity-db\".\"prod_dbt-base\".\"utility_lead_base\"", "batch_results": null}, {"status": "success", "timing": [{"name": "compile", "started_at": "2025-01-02T23:21:18.677842Z", "completed_at": "2025-01-02T23:21:18.686368Z"}, {"name": "execute", "started_at": "2025-01-02T23:21:18.688367Z", "completed_at": "2025-01-02T23:21:25.264552Z"}], "thread_id": "Thread-4 (worker)", "execution_time": 6.667406320571899, "adapter_response": {"_message": "SUCCESS", "rows_affected": -1}, "message": "SUCCESS", "failures": null, "unique_id": "model.integrity_energy_dbt.salesforce_opportunity_base", "compiled": true, "compiled_code": "\n\nWITH base AS (\n\n    SELECT\n        id,\n        name,\n        type,\n        iswon,\n        fiscal,\n        mils__c,\n        ownerid,\n        rate__c,\n        term__c,\n        team__c,\n        source__c,\n        marketing_generator__c,\n        isclosed,\n        notes__c,\n        accountid,\n        csdate__c,\n        closedate,\n        driver__c,\n        meters__c,\n        points__c,\n        stagename,\n        status__c,\n        channel__c,\n        dl_2000__c,\n        dl_4000__c,\n        dl_6000__c,\n        leadsource,\n        manager__c,\n        re_sold__c,\n        renewed__c,\n        createddate,\n        residual__c,\n        sp_rt_id__c,\n        subagent__c,\n        supplier__c,\n        commodity__c,\n        rate_type__c,\n        sp_points__c,\n        sold_date__c,\n        broker_fee__c,\n        cancel_fee__c,\n        usage_type__c,\n        cancel_date__c,\n        dl_1500_kwh__c,\n        dl_2500_kwh__c,\n        dl_3500_kwh__c,\n        dl_rate_gas__c,\n        dl_term_gas__c,\n        dl_owner_alias__c,\n        lost_reason__c,\n        meter_usage__c,\n        owner_title__c,\n        real_points__c,\n        total_usage__c,\n        dl_start_gas__c,\n        dl_usage_gas__c,\n        do_not_renew__c,\n        renewal_date__c,\n        sales_person__c,\n        total_points__c,\n        utility_text__c,\n        sales_manager__c,\n        supplier_text__c,\n        agent_takeback__c,\n        canceled_usage__c,\n        commodity_text__c,\n        contract_signer__c,\n        cancelled_points__c,\n        supplier_credits__c,\n        commission_matrix__c,\n        contract_end_date__c,\n        broker_fee_rounded__c,\n        commission_percent__c,\n        last_activity_note__c,\n        confirmation_number__c,\n        contract_start_date__c,\n        contract_signer_email__c,\n        contract_signer_phone_email__c,\n        contract_signer_facilitator__c,\n        ROW_NUMBER() OVER (\n          PARTITION BY\n            id\n          ORDER BY\n            COALESCE(lastactivitydate, createddate) DESC -- Order by last activity date or created date\n        ) AS rn\n    FROM\n        \"integrity-db\".\"salesforce\".\"opportunity\"\n\n)\n\nSELECT\n    id,\n    name,\n    type,\n    iswon,\n    fiscal,\n    mils__c,\n    ownerid,\n    rate__c,\n    term__c,\n    team__c,\n    source__c,\n    marketing_generator__c,\n    isclosed,\n    notes__c,\n    accountid,\n    csdate__c,\n    closedate,\n    driver__c,\n    meters__c,\n    points__c,\n    stagename,\n    status__c,\n    channel__c,\n    dl_2000__c,\n    dl_4000__c,\n    dl_6000__c,\n    leadsource,\n    manager__c,\n    re_sold__c,\n    renewed__c,\n    createddate,\n    residual__c,\n    sp_rt_id__c,\n    subagent__c,\n    supplier__c,\n    commodity__c,\n    rate_type__c,\n    sp_points__c,\n    sold_date__c,\n    broker_fee__c,\n    cancel_fee__c,\n    usage_type__c,\n    cancel_date__c,\n    dl_1500_kwh__c,\n    dl_2500_kwh__c,\n    dl_3500_kwh__c,\n    dl_rate_gas__c,\n    dl_term_gas__c,\n    dl_owner_alias__c,\n    lost_reason__c,\n    meter_usage__c,\n    owner_title__c,\n    real_points__c,\n    total_usage__c,\n    dl_start_gas__c,\n    dl_usage_gas__c,\n    do_not_renew__c,\n    renewal_date__c,\n    sales_person__c,\n    total_points__c,\n    utility_text__c,\n    sales_manager__c,\n    supplier_text__c,\n    agent_takeback__c,\n    canceled_usage__c,\n    commodity_text__c,\n    contract_signer__c,\n    cancelled_points__c,\n    supplier_credits__c,\n    commission_matrix__c,\n    contract_end_date__c,\n    broker_fee_rounded__c,\n    commission_percent__c,\n    last_activity_note__c,\n    confirmation_number__c,\n    contract_start_date__c,\n    contract_signer_email__c,\n    contract_signer_phone_email__c,\n    contract_signer_facilitator__c\nFROM\n    base\nWHERE\n    rn = 1", "relation_name": "\"integrity-db\".\"prod_dbt-base\".\"salesforce_opportunity_base\"", "batch_results": null}, {"status": "success", "timing": [{"name": "compile", "started_at": "2025-01-02T23:21:25.339764Z", "completed_at": "2025-01-02T23:21:25.339764Z"}, {"name": "execute", "started_at": "2025-01-02T23:21:25.339764Z", "completed_at": "2025-01-02T23:21:28.365134Z"}], "thread_id": "Thread-2 (worker)", "execution_time": 4.232677698135376, "adapter_response": {"_message": "SUCCESS", "rows_affected": -1}, "message": "SUCCESS", "failures": null, "unique_id": "model.integrity_energy_dbt.utility_lead_intermediate", "compiled": true, "compiled_code": "\n\nwith meter_number as (\n    select\n        id,\n        name,\n        city__c,\n        state__c,\n        street__c,\n        zip_code__c,\n        mils__c,\n        commodity__c,\n        createddate,\n        service_address__c,\n        status__c,\n        account__c\n    from \"integrity-db\".\"prod_dbt-base\".\"salesforce_meter_number_base\"\n),\n\naccount as (\n    select\n        id,\n        name,\n        type,\n        phone,\n        industry,\n        billingcity,\n        billingcountry,\n        billingcountrycode,\n        billingpostalcode,\n        billingstreet,\n        main_phone__c\n    from \"integrity-db\".\"prod_dbt-base\".\"salesforce_account_base\"\n),\n\nutility_leads as (\n    select\n        companyname,\n        serviceaddress,\n        servicecity,\n        servicestate,\n        servicezip,\n        utility,\n        accountnumber,\n        annualusage,\n        ratecode,\n        lastname,\n        firstname,\n        title,\n        phone,\n        email\n    from \"integrity-db\".\"prod_dbt-base\".\"utility_lead_base\"\n)\n\nselect\n    m.id as meter_number_id,\n    MIN(m.name) as meter_number_name,\n    MIN(m.city__c) as meter_number_city,\n    MIN(m.state__c) as meter_number_state,\n    MIN(m.street__c) as meter_number_street,\n    MIN(m.zip_code__c) as meter_number_zip_code,\n    MIN(m.mils__c) as meter_number_mils,\n    MIN(m.commodity__c) as meter_number_commodity,\n    MIN(m.createddate) as meter_number_createddate,\n    MIN(m.service_address__c) as meter_number_service_address,\n    MIN(m.status__c) as meter_number_status,\n    MIN(m.account__c) as meter_number_account_id,\n    MIN(a.id) as account_id,\n    MIN(a.name) as account_name,\n    MIN(a.type) as account_type,\n    MIN(a.phone) as account_phone,\n    MIN(a.industry) as account_industry,\n    MIN(a.billingcity) as account_billingcity,\n    MIN(a.billingcountry) as account_billingcountry,\n    MIN(a.billingcountrycode) as account_billingcountrycode,\n    MIN(a.billingpostalcode) as account_billingpostalcode,\n    MIN(a.billingstreet) as account_billingstreet,\n    MIN(a.main_phone__c) as account_main_phone,\n    MIN(u.companyname) as utility_companyname,\n    MIN(u.serviceaddress) as utility_serviceaddress,\n    MIN(u.servicecity) as utility_servicecity,\n    MIN(u.servicestate) as utility_servicestate,\n    MIN(u.servicezip) as utility_servicezip,\n    MIN(u.utility) as utility_utility,\n    MIN(u.accountnumber) as utility_accountnumber,\n    MIN(u.annualusage) as utility_annualusage,\n    MIN(u.ratecode) as utility_ratecode,\n    MIN(u.firstname) as utility_firstname,\n    MIN(u.lastname) as utility_lastname,\n    MIN(u.title) as utility_title,\n    MIN(u.phone) as utility_phone,\n    MIN(u.email) as utility_email\nfrom meter_number as m\nleft join account as a on m.account__c = a.id\nleft join utility_leads as u \non \n    (trim(lower(a.name)) = trim(lower(u.companyname)) AND\n    trim(m.zip_code__c) = trim(u.servicezip) AND\n    trim(lower(m.city__c)) = trim(lower(u.servicecity)) AND\n    regexp_substr(m.street__c, '^[0-9]+') = regexp_substr(u.serviceaddress, '^[0-9]+'))\n    --OR (trim(lower(m.street__c)) = trim(lower(u.serviceaddress)))\ngroup by m.id", "relation_name": "\"integrity-db\".\"prod_dbt-intermediate\".\"utility_lead_intermediate\"", "batch_results": null}, {"status": "success", "timing": [{"name": "compile", "started_at": "2025-01-02T23:21:20.459666Z", "completed_at": "2025-01-02T23:21:20.463665Z"}, {"name": "execute", "started_at": "2025-01-02T23:21:20.463665Z", "completed_at": "2025-01-02T23:21:29.500534Z"}], "thread_id": "Thread-3 (worker)", "execution_time": 9.11346960067749, "adapter_response": {"_message": "SUCCESS", "rows_affected": -1}, "message": "SUCCESS", "failures": null, "unique_id": "model.integrity_energy_dbt.zoominfo_base", "compiled": true, "compiled_code": "\n\nselect\n    *\nfrom\n    \"integrity-db\".\"zoominfo\".\"zoominfo_upload_09202024\"", "relation_name": "\"integrity-db\".\"prod_dbt-base\".\"zoominfo_base\"", "batch_results": null}, {"status": "success", "timing": [{"name": "compile", "started_at": "2025-01-02T23:21:15.875388Z", "completed_at": "2025-01-02T23:21:15.882572Z"}, {"name": "execute", "started_at": "2025-01-02T23:21:15.882572Z", "completed_at": "2025-01-02T23:21:28.952793Z"}], "thread_id": "Thread-1 (worker)", "execution_time": 13.699488639831543, "adapter_response": {"_message": "SUCCESS", "rows_affected": -1}, "message": "SUCCESS", "failures": null, "unique_id": "model.integrity_energy_dbt.salesforce_lead_base", "compiled": true, "compiled_code": "\n\nWITH base AS (\n\n    SELECT\n        id,\n        city,\n        name,\n        LOWER(TRIM(email)) AS email,\n        REGEXP_REPLACE(phone, '[- ', '') AS phone,\n        state,\n        title,\n        status,\n        street,\n        company,\n        country,\n        LOWER(TRIM(REGEXP_REPLACE(firstname, '[^a-zA-Z]', ''))) AS firstname,\n        LOWER(TRIM(REGEXP_REPLACE(lastname, '[^a-zA-Z]', ''))) AS lastname,\n        source__c,\n        channel__c,\n        leadsource,\n        postalcode,\n        createddate,\n        CAST(createddate AS DATE) AS createdday,\n        isconverted,\n        commodity__c,\n        converteddate,\n        lastactivitydate,\n        convertedaccountid,\n        convertedcontactid,\n        lead_id_for_opp__c,\n        average_bill_amount__c,\n        convertedopportunityid,\n        converted_from_lead__c,\n        marketing_generator__c,\n        new_ready_to_work_date__c,\n        last_activity_note_date__c,\n        ROW_NUMBER() OVER (\n          PARTITION BY\n            REGEXP_REPLACE(phone, '[- ]', ''), -- Remove spaces and hyphens from phone numbers\n            LOWER(TRIM(REGEXP_REPLACE(email, '[- ]', ''))), -- Normalize email by converting to lowercase\n            LOWER(TRIM(name)) -- Normalize name by converting to lowercase\n          ORDER BY\n            COALESCE(lastactivitydate, createddate) DESC -- Order by last activity date or created date\n        ) AS rn\n    FROM\n        \"integrity-db\".\"salesforce\".\"lead\"\n\n)\n\nSELECT\n    id,\n    city,\n    name,\n    email,\n    phone,\n    state,\n    title,\n    status,\n    street,\n    company,\n    country,\n    firstname,\n    lastname,\n    source__c,\n    channel__c,\n    leadsource,\n    postalcode,\n    createddate,\n    createdday,\n    isconverted,\n    commodity__c,\n    converteddate,\n    lastactivitydate,\n    convertedaccountid,\n    convertedcontactid,\n    lead_id_for_opp__c,\n    average_bill_amount__c,\n    convertedopportunityid,\n    converted_from_lead__c,\n    marketing_generator__c,\n    new_ready_to_work_date__c,\n    last_activity_note_date__c\nFROM\n    base\nWHERE\n    rn = 1", "relation_name": "\"integrity-db\".\"prod_dbt-base\".\"salesforce_lead_base\"", "batch_results": null}, {"status": "success", "timing": [{"name": "compile", "started_at": "2025-01-02T23:21:29.590541Z", "completed_at": "2025-01-02T23:21:29.619569Z"}, {"name": "execute", "started_at": "2025-01-02T23:21:29.624325Z", "completed_at": "2025-01-02T23:21:32.261424Z"}], "thread_id": "Thread-1 (worker)", "execution_time": 3.3693439960479736, "adapter_response": {"_message": "SUCCESS", "rows_affected": -1}, "message": "SUCCESS", "failures": null, "unique_id": "model.integrity_energy_dbt.lead_intermediate", "compiled": true, "compiled_code": "\n\nwith salesforce_leads as (\n    select\n        id as lead_id,\n        city as lead_city,\n        name as lead_name,\n        email as lead_email,\n        phone as lead_phone,\n        state as lead_state,\n        title as lead_title,\n        status as lead_status,\n        street as lead_street,\n        company as lead_company,\n        country as lead_country,\n        firstname as lead_firstname,\n        lastname as lead_lastname,\n        source__c as lead_source,\n        channel__c as lead_channel,\n        leadsource as lead_leadsource,\n        postalcode as lead_postalcode,\n        createddate as lead_createddate,\n        createdday as lead_createdday,\n        isconverted as lead_isconverted,\n        commodity__c as lead_commodity,\n        converteddate as lead_converteddate,\n        lastactivitydate as lead_lastactivitydate,\n        convertedaccountid as lead_convertedaccountid,\n        convertedcontactid as lead_convertedcontactid,\n        average_bill_amount__c as lead_average_bill_amount,\n        convertedopportunityid as lead_convertedopportunityid,\n        marketing_generator__c as lead_marketing_generator,\n        new_ready_to_work_date__c as lead_new_ready_to_work_date,\n        Concat(company,regexp_substr(street, '^[0-9]+')) as util_join\n    from \"integrity-db\".\"prod_dbt-base\".\"salesforce_lead_base\"\n),\n\nsalesforce_contacts as (\n    select\n        id as contact_id,\n        name as contact_name,\n        email as contact_email,\n        phone as contact_phone,\n        mobilephone as contact_mobilephone,\n        main_phone__c as contact_mainphone,\n        title as contact_title,\n        createddate as contact_createddate,\n        mailingcity as contact_mailingcity,\n        mailingstate as contact_mailingstate,\n        mailingstatecode as contact_mailingstatecode,\n        mailingcountry as contact_mailingcountry,\n        accountid as contact_accountid,\n        rep_last_first__c as contact_rep_last_first,\n        customer_account_number__c as contact_customer_account_number,\n        contract_signer_phone_email__c as contact_contract_signer_phone_email\n    from \"integrity-db\".\"prod_dbt-base\".\"salesforce_contact_base\"\n),\n\nsalesforce_opportunities as (\n    select\n        contract_signer__c as opp_contract_signer,\n        count(distinct(id)) as total_opportunities,\n        sum((case when iswon = true then 1 else 0 end)) as won_opportunities,\n        sum((case when iswon = true then points__c else 0 end)) as won_points,\n        sum((case when iswon = false and isclosed = true then 1 else 0 end)) as lost_opportunities,\n        sum((case when isclosed = false then 1 else 0 end)) as open_opportunities,\n        sum((case when isclosed = true then 1 else 0 end)) as closed_opportunities\n    from \"integrity-db\".\"prod_dbt-base\".\"salesforce_opportunity_base\"\n    group by opp_contract_signer\n),\n\nutility_lead as (\n    select\n        companyname as utility_companyname,\n        serviceaddress as utility_serviceaddress,\n        servicecity as utility_servicecity,\n        servicezip as utility_servicezip,\n        phone as utility_phone,\n        Concat(companyname,regexp_substr(serviceaddress, '^[0-9]+')) as lead_join\n    from \"integrity-db\".\"prod_dbt-base\".\"utility_lead_base\"\n)\n\nselect\n(NVL(l.lead_id,'-') || NVL(c.contact_id,'-') || NVL(u.lead_join,'-')) as lead_master_id,\n*\nfrom salesforce_leads as l\nfull join salesforce_contacts as c on l.lead_convertedcontactid = c.contact_id\nfull join utility_lead as u on l.util_join = u.lead_join\nleft join salesforce_opportunities as o on c.contact_id = o.opp_contract_signer", "relation_name": "\"integrity-db\".\"prod_dbt-intermediate\".\"lead_intermediate\"", "batch_results": null}, {"status": "success", "timing": [{"name": "compile", "started_at": "2025-01-02T23:21:29.586938Z", "completed_at": "2025-01-02T23:21:29.619569Z"}, {"name": "execute", "started_at": "2025-01-02T23:21:29.620758Z", "completed_at": "2025-01-02T23:21:32.858076Z"}], "thread_id": "Thread-3 (worker)", "execution_time": 3.3703436851501465, "adapter_response": {"_message": "SUCCESS", "rows_affected": -1}, "message": "SUCCESS", "failures": null, "unique_id": "model.integrity_energy_dbt.deal_intermediate", "compiled": true, "compiled_code": "\n\nwith salesforce_opportunities as (\n    select\n        id,\n        name,\n        type,\n        iswon,\n        fiscal,\n        mils__c,\n        ownerid,\n        rate__c,\n        term__c,\n        team__c,\n        source__c,\n        marketing_generator__c,\n        isclosed,\n        notes__c,\n        accountid,\n        csdate__c,\n        closedate,\n        driver__c,\n        meters__c,\n        points__c,\n        stagename,\n        status__c,\n        channel__c,\n        leadsource,\n        manager__c,\n        re_sold__c,\n        renewed__c,\n        createddate,\n        residual__c,\n        sp_rt_id__c,\n        subagent__c,\n        supplier__c,\n        commodity__c,\n        rate_type__c,\n        sp_points__c,\n        sold_date__c,\n        broker_fee__c,\n        cancel_fee__c,\n        usage_type__c,\n        cancel_date__c,\n        dl_rate_gas__c,\n        dl_owner_alias__c,\n        dl_term_gas__c,\n        lost_reason__c,\n        meter_usage__c,\n        owner_title__c,\n        real_points__c,\n        total_usage__c,\n        dl_start_gas__c,\n        dl_usage_gas__c,\n        do_not_renew__c,\n        renewal_date__c,\n        sales_person__c,\n        total_points__c,\n        utility_text__c,\n        sales_manager__c,\n        supplier_text__c,\n        agent_takeback__c,\n        canceled_usage__c,\n        commodity_text__c,\n        contract_signer__c,\n        cancelled_points__c,\n        supplier_credits__c,\n        commission_matrix__c,\n        contract_end_date__c,\n        broker_fee_rounded__c,\n        commission_percent__c,\n        last_activity_note__c,\n        confirmation_number__c,\n        contract_start_date__c,\n        contract_signer_email__c,\n        contract_signer_phone_email__c,\n        contract_signer_facilitator__c\n    from \"integrity-db\".\"prod_dbt-base\".\"salesforce_opportunity_base\"\n),\n\nsalesforce_contacts as (\n    select\n        id as contact_id,\n        name as contact_name,\n        email as contact_email,\n        phone as contact_phone,\n        mobilephone as contact_mobilephone,\n        main_phone__c as contact_mainphone,\n        title as contact_title,\n        createddate as contact_createddate,\n        mailingcity as contact_mailingcity,\n        mailingstate as contact_mailingstate,\n        mailingstatecode as contact_mailingstatecode,\n        mailingcountry as contact_mailingcountry,\n        accountid as contact_accountid,\n        rep_last_first__c as contact_rep_last_first,\n        customer_account_number__c as contact_customer_account_number,\n        contract_signer_phone_email__c as contact_contract_signer_phone_email\n    from \"integrity-db\".\"prod_dbt-base\".\"salesforce_contact_base\"\n),\n\nsalesforce_leads as (\n    select\n        id as lead_id,\n        city as lead_city,\n        name as lead_name,\n        email as lead_email,\n        phone as lead_phone,\n        state as lead_state,\n        title as lead_title,\n        status as lead_status,\n        street as lead_street,\n        company as lead_company,\n        country as lead_country,\n        firstname as lead_firstname,\n        lastname as lead_lastname,\n        source__c as lead_source,\n        channel__c as lead_channel,\n        leadsource as lead_leadsource,\n        postalcode as lead_postalcode,\n        createddate as lead_createddate,\n        isconverted as lead_isconverted,\n        commodity__c as lead_commodity,\n        converteddate as lead_converteddate,\n        lastactivitydate as lead_lastactivitydate,\n        convertedaccountid as lead_convertedaccountid,\n        convertedcontactid as lead_convertedcontactid,\n        average_bill_amount__c as lead_average_bill_amount,\n        convertedopportunityid as lead_convertedopportunityid,\n        marketing_generator__c as lead_marketing_generator,\n        new_ready_to_work_date__c as lead_new_ready_to_work_date\n    from \"integrity-db\".\"prod_dbt-base\".\"salesforce_lead_base\"\n)\n\nselect\n*\nfrom salesforce_opportunities as o\nleft join salesforce_leads as l on l.lead_convertedcontactid = o.contract_signer__c\nleft join salesforce_contacts as c on c.contact_id = o.contract_signer__c", "relation_name": "\"integrity-db\".\"prod_dbt-intermediate\".\"deal_intermediate\"", "batch_results": null}, {"status": "success", "timing": [{"name": "compile", "started_at": "2025-01-02T23:21:25.371505Z", "completed_at": "2025-01-02T23:21:25.373994Z"}, {"name": "execute", "started_at": "2025-01-02T23:21:25.380890Z", "completed_at": "2025-01-02T23:21:35.877802Z"}], "thread_id": "Thread-4 (worker)", "execution_time": 10.588775873184204, "adapter_response": {"_message": "SUCCESS", "rows_affected": -1}, "message": "SUCCESS", "failures": null, "unique_id": "model.integrity_energy_dbt.marketing_intermediate", "compiled": true, "compiled_code": "\n\nwith google_ads as (\n    select\n        activity_date,\n        sum(googleads_impressions) as googleads_impressions,\n        ROUND((sum(googleads_cost) / 1000000),2) as googleads_cost,\n        sum(googleads_clicks) as googleads_clicks\n    from \"integrity-db\".\"prod_dbt-base\".\"google_ads_daily_base\"\n    group by activity_date\n),\n\nbing_ads as (\n    select\n        timeperiod,\n        sum(spend) as bing_spend,\n        sum(impressions) as bing_impressions,\n        sum(clicks) as bing_clicks\n    from \"integrity-db\".\"prod_dbt-base\".\"bing_ads_daily_base\"\n    group by timeperiod\n),\n\nhubspot as (\n    select\n        converted_date,\n        sent_emails as hubspot_sent_emails,\n        opened_emails as hubspot_opened_emails,\n        clicks as hubspot_clicks,\n        bounces as hubspot_bounces,\n        spam_reports as hubspot_spam_reports\n    from \"integrity-db\".\"prod_dbt-base\".\"hubspot_daily_base\"\n),\n\nfacebook as (\n    select\n        date_start,\n        facebook_impressions,\n        facebook_reach,\n        facebook_spend,\n        facebook_clicks,\n        facebook_unique_clicks\n    from \"integrity-db\".\"prod_dbt-base\".\"facebook_daily_base\"\n),\n\nopportunity_sold as (\n    SELECT\n    sold_date__c,\n    sum(case when iswon = true and status__c <> 'Cancelled' then 1 else 0 end) as total_won_opportunities,\n    sum(case when iswon = true and status__c <> 'Cancelled' then points__c else 0 end) as total_won_points,\n    sum(case when iswon = true and status__c <> 'Cancelled' and team__c = 'Paid' then 1 else 0 end) as paid_won_opportunities,\n    sum(case when iswon = true and status__c <> 'Cancelled' and team__c = 'Paid' then points__c else 0 end) as paid_won_points,\n    sum(case when iswon = true and status__c <> 'Cancelled' and team__c = 'Earned' then 1 else 0 end) as earned_won_opportunities,\n    sum(case when iswon = true and status__c <> 'Cancelled' and team__c = 'Earned' then points__c else 0 end) as earned_won_points,\n    sum(case when iswon = true and status__c <> 'Cancelled' and team__c = 'Owned' then 1 else 0 end) as owned_won_opportunities,\n    sum(case when iswon = true and status__c <> 'Cancelled' and team__c = 'Owned' then points__c else 0 end) as owned_won_points,\n    sum(case when iswon = true and status__c <> 'Cancelled' and source__c = 'Google' then 1 else 0 end) as google_won_opportunities,\n    sum(case when iswon = true and status__c <> 'Cancelled' and source__c = 'Google' then points__c else 0 end) as google_won_points,\n    sum(case when iswon = true and status__c <> 'Cancelled' and source__c = 'Microsoft' then 1 else 0 end) as microsoft_won_opportunities,\n    sum(case when iswon = true and status__c <> 'Cancelled' and source__c = 'Microsoft' then points__c else 0 end) as microsoft_won_points,\n    sum(case when iswon = true and status__c <> 'Cancelled' and source__c = 'Email' then 1 else 0 end) as email_won_opportunities,\n    sum(case when iswon = true and status__c <> 'Cancelled' and source__c = 'Email' then points__c else 0 end) as email_won_points\nfrom \"integrity-db\".\"prod_dbt-base\".\"salesforce_opportunity_base\"\nwhere marketing_generator__c = '0035f00000G8KYcAAN'\ngroup by sold_date__c\n),\n\nopportunity_cancelled as (\nSELECT\n    cancel_date__c,\n    sum(case when iswon = true and status__c = 'Cancelled' then 1 else 0 end) as total_cancelled_opportunities,\n    sum(case when iswon = true and cancel_date__c <> NULL then cancelled_points__c else 0 end) as total_cancelled_points\nfrom \"integrity-db\".\"prod_dbt-base\".\"salesforce_opportunity_base\"\nwhere marketing_generator__c = '0035f00000G8KYcAAN'\ngroup by cancel_date__c\n),\n\nmarketing_cost as (\nselect\n    team,\n    month,\n    hom_cost,\n    ipr_cost,\n    copywriter,\n    dango_costs,\n    designer_costs,\n    paid_lead_cost,\n    data_contractor,\n    seo_lead_salary,\n    contractor_costs,\n    paid_agency_cost,\n    paid_support_cost,\n    project_management,\n    crowd_content_costs,\n    email_contractor_costs,\n    hubspot_contractor_costs\nfrom \"integrity-db\".\"prod_dbt-base\".\"marketing_cost_base\"\n),\n\nbase_dates as (\n    select\n        CAST(date as date)\n    from \"integrity-db\".\"google_sheets\".\"dates\"\n)\n\nselect \n    COALESCE(d.date, o.sold_date__c, b.timeperiod, h.converted_date, f.date_start, g.activity_date, c.cancel_date__c, m.month) AS activity_date,\n    COALESCE(g.googleads_cost, 0) AS googleads_cost,\n    COALESCE(g.googleads_impressions, 0) AS googleads_impressions,\n    COALESCE(g.googleads_clicks, 0) AS googleads_clicks,\n    COALESCE(b.bing_spend, 0) AS bing_spend,\n    COALESCE(b.bing_impressions, 0) AS bing_impressions,\n    COALESCE(b.bing_clicks, 0) AS bing_clicks,\n    COALESCE(h.hubspot_sent_emails, 0) AS hubspot_sent_emails,\n    COALESCE(h.hubspot_opened_emails, 0) AS hubspot_opened_emails,\n    COALESCE(h.hubspot_clicks, 0) AS hubspot_clicks,\n    COALESCE(h.hubspot_bounces, 0) AS hubspot_bounces,\n    COALESCE(h.hubspot_spam_reports, 0) AS hubspot_spam_reports,\n    COALESCE(f.facebook_impressions, 0) AS facebook_impressions,\n    COALESCE(f.facebook_reach, 0) AS facebook_reach,\n    COALESCE(f.facebook_spend, 0) AS facebook_spend, \n    COALESCE(f.facebook_clicks, 0) AS facebook_clicks,\n    COALESCE(f.facebook_unique_clicks, 0) AS facebook_unique_clicks,\n    COALESCE(o.total_won_opportunities, 0) AS total_won_opportunities,\n    COALESCE(o.total_won_points, 0) AS total_won_points,\n    COALESCE(o.paid_won_opportunities, 0) AS paid_won_opportunities,\n    COALESCE(o.paid_won_points, 0) AS paid_won_points,\n    COALESCE(o.earned_won_opportunities, 0) AS earned_won_opportunities,\n    COALESCE(o.earned_won_points, 0) AS earned_won_points,\n    COALESCE(o.owned_won_opportunities, 0) AS owned_won_opportunities,\n    COALESCE(o.owned_won_points, 0) AS owned_won_points,\n    COALESCE(o.google_won_opportunities, 0) AS google_won_opportunities,\n    COALESCE(o.google_won_points, 0) AS google_won_points,\n    COALESCE(o.microsoft_won_opportunities, 0) AS microsoft_won_opportunities,\n    COALESCE(o.microsoft_won_points, 0) AS microsoft_won_points,\n    COALESCE(o.email_won_opportunities, 0) AS email_won_opportunities,\n    COALESCE(o.email_won_points, 0) AS email_won_points,\n    COALESCE(c.total_cancelled_opportunities, 0) AS total_cancelled_opportunities,\n    COALESCE(c.total_cancelled_points, 0) AS total_cancelled_points,\n    m.team AS team,\n    m.month AS cost_month,\n    COALESCE(m.hom_cost, 0) AS hom_cost,\n    COALESCE(m.ipr_cost, 0) AS ipr_cost,\n    COALESCE(m.copywriter, 0) AS copywriter,\n    COALESCE(m.dango_costs, 0) AS dango_costs,\n    COALESCE(m.designer_costs, 0) AS designer_costs,\n    COALESCE(m.paid_lead_cost, 0) AS paid_lead_cost,\n    COALESCE(m.data_contractor, 0) AS data_contractor,\n    COALESCE(m.seo_lead_salary, 0) AS seo_lead_salary,\n    COALESCE(m.contractor_costs, 0) AS contractor_costs,\n    COALESCE(m.paid_agency_cost, 0) AS paid_agency_cost,\n    COALESCE(m.paid_support_cost, 0) AS paid_support_cost,\n    COALESCE(m.project_management, 0) AS project_management,\n    COALESCE(m.crowd_content_costs, 0) AS crowd_content_costs,\n    COALESCE(m.email_contractor_costs, 0) AS email_contractor_costs,\n    COALESCE(m.hubspot_contractor_costs, 0) AS hubspot_contractor_costs,\n    COALESCE(SUM(COALESCE(m.data_contractor, 0) + COALESCE(m.hubspot_contractor_costs, 0) + COALESCE(m.email_contractor_costs, 0)),0) as total_contractor_costs,\n    COALESCE(SUM(COALESCE(m.hom_cost, 0) + COALESCE(m.ipr_cost, 0) + COALESCE(m.copywriter, 0) + COALESCE(m.designer_costs, 0) + COALESCE(m.paid_lead_cost, 0) + COALESCE(m.seo_lead_salary, 0) + COALESCE(m.paid_support_cost, 0) + COALESCE(m.project_management, 0)),0) as operational_costs, \n    COALESCE(SUM(COALESCE(g.googleads_cost,0) + COALESCE(b.bing_spend,0) + COALESCE(f.facebook_spend,0)),0) as total_spend,\n    COALESCE(SUM(COALESCE(g.googleads_clicks,0) + COALESCE(b.bing_clicks,0) + COALESCE(f.facebook_clicks,0)),0) as total_clicks,\n    COALESCE(SUM(COALESCE(g.googleads_impressions,0) + COALESCE(b.bing_impressions,0) + COALESCE(f.facebook_impressions,0)),0) as total_impressions,\n    CASE\n        WHEN COALESCE(SUM(COALESCE(g.googleads_clicks,0) + COALESCE(b.bing_clicks,0) + COALESCE(f.facebook_clicks,0)),0) = 0 THEN 0\n        ELSE COALESCE(SUM(COALESCE(g.googleads_cost,0) + COALESCE(b.bing_spend,0) + COALESCE(f.facebook_spend,0)),0) / COALESCE(SUM(COALESCE(g.googleads_clicks,0) + COALESCE(b.bing_clicks,0) + COALESCE(f.facebook_clicks,0)),0)\n    END AS cost_per_click,\n    CASE\n        WHEN COALESCE(SUM(COALESCE(g.googleads_impressions,0) + COALESCE(b.bing_impressions,0) + COALESCE(f.facebook_impressions,0)),0) = 0 THEN 0\n        ELSE COALESCE(SUM(COALESCE(g.googleads_cost,0) + COALESCE(b.bing_spend,0) + COALESCE(f.facebook_spend,0)),0) / COALESCE(SUM(COALESCE(g.googleads_impressions,0) + COALESCE(b.bing_impressions,0) + COALESCE(f.facebook_impressions,0)),0)\n    END AS cost_per_impression,\n    CASE\n        WHEN COALESCE(SUM(o.total_won_opportunities), 0) = 0 THEN 0\n        ELSE COALESCE(SUM(COALESCE(g.googleads_cost,0) + COALESCE(b.bing_spend,0) + COALESCE(f.facebook_spend,0)),0) / COALESCE(SUM(o.total_won_opportunities), 0)\n    END AS cost_per_deal,\n    CASE\n        WHEN COALESCE(SUM(COALESCE(g.googleads_cost,0) + COALESCE(b.bing_spend,0) + COALESCE(f.facebook_spend,0)),0) = 0 THEN 0\n        ELSE (((SUM(o.total_won_points) * 100) / COALESCE(SUM(COALESCE(g.googleads_cost,0) + COALESCE(b.bing_spend,0) + COALESCE(f.facebook_spend,0)),0)) / 100)\n    END AS return_on_investment\nfrom base_dates as d \nleft outer join opportunity_sold as o on d.date = o.sold_date__c\nleft outer join hubspot as h on d.date = h.converted_date\nleft outer join bing_ads as b on b.timeperiod = d.date\nleft outer join facebook as f on f.date_start = d.date\nleft outer join google_ads as g on g.activity_date = d.date\nleft outer join opportunity_cancelled as c on c.cancel_date__c = d.date\nleft outer join marketing_cost as m on d.date = m.month\ngroup by 1,2,3,4,5,6,7,8,9,10,11,12,13,14,15,16,17,18,19,20,21,22,23,24,25,26,27,28,29,30,31,32,33,34,35,36,37,38,39,40,41,42,43,44,45,46,47,48,49,50", "relation_name": "\"integrity-db\".\"prod_dbt-intermediate\".\"marketing_intermediate\"", "batch_results": null}, {"status": "success", "timing": [{"name": "compile", "started_at": "2025-01-02T23:21:29.584938Z", "completed_at": "2025-01-02T23:21:29.593546Z"}, {"name": "execute", "started_at": "2025-01-02T23:21:29.594546Z", "completed_at": "2025-01-02T23:21:38.115933Z"}], "thread_id": "Thread-2 (worker)", "execution_time": 8.616137742996216, "adapter_response": {"_message": "SUCCESS", "rows_affected": -1}, "message": "SUCCESS", "failures": null, "unique_id": "model.integrity_energy_dbt.utility_lead_prod", "compiled": true, "compiled_code": "\n\nselect\n    *\nfrom \"integrity-db\".\"prod_dbt-intermediate\".\"utility_lead_intermediate\"", "relation_name": "\"integrity-db\".\"prod_dbt-mart\".\"utility_lead_prod\"", "batch_results": null}, {"status": "success", "timing": [{"name": "compile", "started_at": "2025-01-02T23:21:38.198077Z", "completed_at": "2025-01-02T23:21:38.198077Z"}, {"name": "execute", "started_at": "2025-01-02T23:21:38.198077Z", "completed_at": "2025-01-02T23:21:45.196666Z"}], "thread_id": "Thread-2 (worker)", "execution_time": 7.09329891204834, "adapter_response": {"_message": "SUCCESS", "rows_affected": -1}, "message": "SUCCESS", "failures": null, "unique_id": "model.integrity_energy_dbt.marketing_prod", "compiled": true, "compiled_code": "\n\nselect\n    *\nfrom \"integrity-db\".\"prod_dbt-intermediate\".\"marketing_intermediate\"\nwhere activity_date IS NOT NULL", "relation_name": "\"integrity-db\".\"prod_dbt-mart\".\"marketing_prod\"", "batch_results": null}, {"status": "success", "timing": [{"name": "compile", "started_at": "2025-01-02T23:21:32.975432Z", "completed_at": "2025-01-02T23:21:32.975432Z"}, {"name": "execute", "started_at": "2025-01-02T23:21:32.983938Z", "completed_at": "2025-01-02T23:21:52.794931Z"}], "thread_id": "Thread-3 (worker)", "execution_time": 20.638284921646118, "adapter_response": {"_message": "SUCCESS", "rows_affected": -1}, "message": "SUCCESS", "failures": null, "unique_id": "model.integrity_energy_dbt.lead_prod", "compiled": true, "compiled_code": "\n\nselect\n    *\nfrom \"integrity-db\".\"prod_dbt-intermediate\".\"lead_intermediate\"", "relation_name": "\"integrity-db\".\"prod_dbt-mart\".\"lead_prod\"", "batch_results": null}, {"status": "success", "timing": [{"name": "compile", "started_at": "2025-01-02T23:21:35.958014Z", "completed_at": "2025-01-02T23:21:35.958014Z"}, {"name": "execute", "started_at": "2025-01-02T23:21:35.958014Z", "completed_at": "2025-01-02T23:21:53.538849Z"}], "thread_id": "Thread-4 (worker)", "execution_time": 17.652567148208618, "adapter_response": {"_message": "SUCCESS", "rows_affected": -1}, "message": "SUCCESS", "failures": null, "unique_id": "model.integrity_energy_dbt.deal_prod", "compiled": true, "compiled_code": "\n\nselect\n    *\nfrom \"integrity-db\".\"prod_dbt-intermediate\".\"deal_intermediate\"", "relation_name": "\"integrity-db\".\"prod_dbt-mart\".\"deal_prod\"", "batch_results": null}, {"status": "success", "timing": [{"name": "compile", "started_at": "2025-01-02T23:21:32.967921Z", "completed_at": "2025-01-02T23:21:32.975432Z"}, {"name": "execute", "started_at": "2025-01-02T23:21:32.975432Z", "completed_at": "2025-01-02T23:21:54.805464Z"}], "thread_id": "Thread-1 (worker)", "execution_time": 21.902934312820435, "adapter_response": {"_message": "SUCCESS", "rows_affected": -1}, "message": "SUCCESS", "failures": null, "unique_id": "model.integrity_energy_dbt._1_fuzzy_data_clean", "compiled": true, "compiled_code": "\n\n-- Data Cleaning\n\nSELECT\n    LOWER(TRIM(REGEXP_REPLACE(lead_lastname, '[^a-zA-Z]', ''))) AS fuzzy_match_lastname_key,\n    LOWER(TRIM(REGEXP_REPLACE(lead_firstname, '[^a-zA-Z]', ''))) AS fuzzy_match_firstname_key,\n    LOWER(TRIM(lead_email)) AS fuzzy_match_email_key,\n    LOWER(TRIM(REGEXP_REPLACE(lead_phone, '[- ]', ''))) AS fuzzy_match_phone_key,\n    LOWER(TRIM(REGEXP_REPLACE(lead_lastname, '[^a-zA-Z]', ''))) ||\n        LOWER(TRIM(REGEXP_REPLACE(lead_firstname, '[^a-zA-Z]', ''))) ||\n        LOWER(TRIM(REGEXP_REPLACE(lead_phone, '[- ]', ''))) ||\n        LOWER(TRIM(lead_email)) AS fuzzy_match_key,\n    RANK() OVER (ORDER BY LOWER(TRIM(lead_email)) ASC\n        , LOWER(TRIM(REGEXP_REPLACE(lead_phone, '[- ]', ''))) ASC\n        , LOWER(TRIM(REGEXP_REPLACE(lead_lastname, '[^a-zA-Z]', ''))) ASC\n        , LOWER(TRIM(REGEXP_REPLACE(lead_firstname, '[^a-zA-Z]', ''))) ASC) AS seq_nbr\nFROM\n    \"integrity-db\".\"prod_dbt-intermediate\".\"lead_intermediate\"", "relation_name": "\"integrity-db\".\"prod_dbt-unification\".\"_1_fuzzy_data_clean\"", "batch_results": null}, {"status": "success", "timing": [{"name": "compile", "started_at": "2025-01-02T23:21:54.875853Z", "completed_at": "2025-01-02T23:21:54.879357Z"}, {"name": "execute", "started_at": "2025-01-02T23:21:54.879357Z", "completed_at": "2025-01-02T23:21:57.250014Z"}], "thread_id": "Thread-2 (worker)", "execution_time": 2.4415948390960693, "adapter_response": {"_message": "SUCCESS", "rows_affected": -1}, "message": "SUCCESS", "failures": null, "unique_id": "model.integrity_energy_dbt._2_soundex", "compiled": true, "compiled_code": "\n\n--Soundex algortihm\n\nSELECT\n  fuzzy_match_key,\n  SOUNDEX(fuzzy_match_lastname_key) ||\n  SOUNDEX(fuzzy_match_firstname_key) ||\n  SOUNDEX(fuzzy_match_phone_key) ||\n  SOUNDEX(fuzzy_match_email_key) AS group_key,\n  seq_nbr\nFROM\n  \"integrity-db\".\"prod_dbt-unification\".\"_1_fuzzy_data_clean\"", "relation_name": "\"integrity-db\".\"prod_dbt-unification\".\"_2_soundex\"", "batch_results": null}, {"status": "success", "timing": [{"name": "compile", "started_at": "2025-01-02T23:21:57.322745Z", "completed_at": "2025-01-02T23:21:57.325754Z"}, {"name": "execute", "started_at": "2025-01-02T23:21:57.326754Z", "completed_at": "2025-01-02T23:21:59.590781Z"}], "thread_id": "Thread-4 (worker)", "execution_time": 2.338998556137085, "adapter_response": {"_message": "SUCCESS", "rows_affected": -1}, "message": "SUCCESS", "failures": null, "unique_id": "model.integrity_energy_dbt._3_master_key", "compiled": true, "compiled_code": "\n\nSELECT\n    fuzzy_data.fuzzy_match_key,\n    fuzzy_data.group_key,\n    temp.fuzzy_match_key AS master_key,\n    fuzzy_data.seq_nbr AS seq_nbr\nFROM\n    (SELECT\n         fuzzy_match_key,\n         group_key\n     FROM\n        (SELECT\n          fuzzy_match_key,\n          group_key,\n          ROW_NUMBER() OVER (PARTITION BY group_key ORDER BY group_key DESC) AS rn\n         FROM\n          \"integrity-db\".\"prod_dbt-unification\".\"_2_soundex\") t1\n     WHERE\n         rn = 1) AS temp,\n         \"integrity-db\".\"prod_dbt-unification\".\"_2_soundex\" AS fuzzy_data\nWHERE\n    temp.group_key = fuzzy_data.group_key", "relation_name": "\"integrity-db\".\"prod_dbt-unification\".\"_3_master_key\"", "batch_results": null}, {"status": "success", "timing": [{"name": "compile", "started_at": "2025-01-02T23:22:00.174242Z", "completed_at": "2025-01-02T23:22:00.177760Z"}, {"name": "execute", "started_at": "2025-01-02T23:22:00.177760Z", "completed_at": "2025-01-02T23:22:02.263259Z"}], "thread_id": "Thread-3 (worker)", "execution_time": 2.1540584564208984, "adapter_response": {"_message": "SUCCESS", "rows_affected": -1}, "message": "SUCCESS", "failures": null, "unique_id": "model.integrity_energy_dbt._4_levenshtein", "compiled": true, "compiled_code": "\n\n-- Levenshtein with Filtering\n\nSELECT\n    fuzzy_match_key,\n    master_key,\n    group_key,\n    CASE\n        WHEN fuzzy_match_key = master_key THEN 100\n        ELSE 100 - ABS(LENGTH(fuzzy_match_key) - LENGTH(master_key))\n    END AS levenshtein_ratio,\n    seq_nbr\nFROM\n    \"integrity-db\".\"prod_dbt-unification\".\"_3_master_key\"\nWHERE\n    CASE\n        WHEN fuzzy_match_key = master_key THEN 100\n        ELSE 100 - ABS(LENGTH(fuzzy_match_key) - LENGTH(master_key))\n    END >= 80.0", "relation_name": "\"integrity-db\".\"prod_dbt-unification\".\"_4_levenshtein\"", "batch_results": null}, {"status": "success", "timing": [{"name": "compile", "started_at": "2025-01-02T23:22:02.344176Z", "completed_at": "2025-01-02T23:22:02.344176Z"}, {"name": "execute", "started_at": "2025-01-02T23:22:02.344176Z", "completed_at": "2025-01-02T23:22:04.757746Z"}], "thread_id": "Thread-1 (worker)", "execution_time": 2.4783880710601807, "adapter_response": {"_message": "SUCCESS", "rows_affected": -1}, "message": "SUCCESS", "failures": null, "unique_id": "model.integrity_energy_dbt._5_match_store", "compiled": true, "compiled_code": "\n\n--Match Store\n\nSELECT\n  group_key,\n  LISTAGG(seq_nbr, ',') WITHIN GROUP (ORDER BY seq_nbr) AS groups\nFROM\n  \"integrity-db\".\"prod_dbt-unification\".\"_4_levenshtein\"\nGROUP BY\n  group_key", "relation_name": "\"integrity-db\".\"prod_dbt-unification\".\"_5_match_store\"", "batch_results": null}, {"status": "success", "timing": [{"name": "compile", "started_at": "2025-01-02T23:22:02.344176Z", "completed_at": "2025-01-02T23:22:02.344176Z"}, {"name": "execute", "started_at": "2025-01-02T23:22:02.344176Z", "completed_at": "2025-01-02T23:22:12.675002Z"}], "thread_id": "Thread-4 (worker)", "execution_time": 10.396935224533081, "adapter_response": {"_message": "SUCCESS", "rows_affected": -1}, "message": "SUCCESS", "failures": null, "unique_id": "model.integrity_energy_dbt._6_lead_enriched", "compiled": true, "compiled_code": "\n\nWITH aggregated_customers  AS (\n\n  SELECT\n    lead_master_id\n    ,MAX(LOWER(TRIM(lead_email))) as lead_email\n    ,MAX(LOWER(TRIM(REGEXP_REPLACE(lead_phone, '[- ]', '')))) as lead_phone\n    ,MAX(LOWER(TRIM(REGEXP_REPLACE(lead_lastname, '[^a-zA-Z]', '')))) as lead_lastname\n    ,MAX(LOWER(TRIM(REGEXP_REPLACE(lead_firstname, '[^a-zA-Z]', '')))) as lead_firstname\n  FROM\n    \"integrity-db\".\"prod_dbt-mart\".\"lead_prod\"\n  GROUP BY\n    lead_master_id\n\n),\n\nadd_keys AS (\n\n  SELECT\n    lead_master_id\n    ,LOWER(TRIM(lead_lastname)) ||\n        LOWER(TRIM(lead_firstname)) ||\n        LOWER(TRIM(lead_phone)) ||\n        LOWER(TRIM(lead_email)) AS fuzzy_match_key\n    ,lead_email\n    ,lead_phone\n    ,lead_lastname\n    ,lead_firstname\n  FROM\n    aggregated_customers\n\n),\n\nadd_master_key AS (\n\n  SELECT\n    keys.lead_master_id\n    ,keys.fuzzy_match_key\n    ,unify.master_key\n    ,unify.group_key\n    ,keys.lead_firstname\n    ,keys.lead_lastname\n    ,keys.lead_email\n    ,keys.lead_phone\n  FROM\n    add_keys AS keys\n    LEFT JOIN \"integrity-db\".\"prod_dbt-unification\".\"_4_levenshtein\" AS unify\n      ON keys.fuzzy_match_key = unify.fuzzy_match_key\n        AND unify.levenshtein_ratio = 100\n\n)\n\nSELECT\n  lead_master_id\n  ,fuzzy_match_key\n  ,master_key\n  ,group_key\n  ,lead_firstname\n  ,lead_lastname\n  ,lead_email\n  ,lead_phone\nFROM\n  add_master_key\nWHERE\n  master_key IS NOT NULL", "relation_name": "\"integrity-db\".\"prod_dbt-unification\".\"_6_lead_enriched\"", "batch_results": null}], "elapsed_time": 70.44359946250916, "args": {"project_dir": "C:\\Users\\2ewol\\Documents\\Clients\\Integrity_Energy\\integrity-energy-dbt", "which": "run", "use_colors": true, "macro_debugging": false, "empty": false, "partial_parse": true, "indirect_selection": "eager", "version_check": true, "invocation_command": "dbt run --select tag:daily", "log_level_file": "debug", "defer": false, "static_parser": true, "introspect": true, "show_resource_report": false, "skip_nodes_if_on_run_start_fails": false, "strict_mode": false, "log_format": "default", "state_modified_compare_more_unrendered_values": false, "populate_cache": true, "state_modified_compare_vars": false, "select": ["tag:daily"], "exclude": [], "print": true, "use_colors_file": true, "require_resource_names_without_spaces": false, "write_json": true, "log_level": "info", "send_anonymous_usage_stats": true, "log_file_max_bytes": 10485760, "log_path": "C:\\Users\\2ewol\\Documents\\Clients\\Integrity_Energy\\integrity-energy-dbt\\logs", "require_explicit_package_overrides_for_builtin_materializations": true, "source_freshness_run_project_hooks": false, "quiet": false, "vars": {}, "printer_width": 80, "favor_state": false, "partial_parse_file_diff": true, "warn_error_options": {"include": [], "exclude": []}, "profiles_dir": "C:\\Users\\2ewol\\Documents\\Clients\\Integrity_Energy\\integrity-energy-dbt", "log_format_file": "debug", "cache_selected_only": false}}