{"metadata": {"dbt_schema_version": "https://schemas.getdbt.com/dbt/run-results/v6.json", "dbt_version": "1.9.0b2", "generated_at": "2025-02-04T19:59:32.299882Z", "invocation_id": "a85d3666-9ee7-4a27-8633-e99ce13277bc", "env": {}}, "results": [{"status": "success", "timing": [{"name": "compile", "started_at": "2025-02-04T19:56:20.239196Z", "completed_at": "2025-02-04T19:56:20.273156Z"}, {"name": "execute", "started_at": "2025-02-04T19:56:20.282520Z", "completed_at": "2025-02-04T19:56:22.486757Z"}], "thread_id": "Thread-3 (worker)", "execution_time": 2.338421106338501, "adapter_response": {"_message": "SUCCESS", "rows_affected": -1}, "message": "SUCCESS", "failures": null, "unique_id": "model.integrity_energy_dbt.google_ads_daily_base", "compiled": true, "compiled_code": "\n\nselect\n    DATE(_data_date) as activity_date, \n    metrics_impressions as googleads_impressions,\n    metrics_cost_micros  as googleads_cost, \n    metrics_clicks as googleads_clicks\nfrom \"integrity-db\".\"google_ads\".\"ads_campaignbasicstats_7446470445\"", "relation_name": "\"integrity-db\".\"prod_dbt-base\".\"google_ads_daily_base\"", "batch_results": null}, {"status": "success", "timing": [{"name": "compile", "started_at": "2025-02-04T19:56:20.242191Z", "completed_at": "2025-02-04T19:56:20.279483Z"}, {"name": "execute", "started_at": "2025-02-04T19:56:20.313367Z", "completed_at": "2025-02-04T19:56:25.896509Z"}], "thread_id": "Thread-4 (worker)", "execution_time": 6.703701019287109, "adapter_response": {"_message": "SUCCESS", "rows_affected": -1}, "message": "SUCCESS", "failures": null, "unique_id": "model.integrity_energy_dbt.hubspot_daily_base", "compiled": true, "compiled_code": "\n\nwith hubspot_daily as (\n    SELECT\n        (TIMESTAMP 'epoch' + created / 1000 * INTERVAL '1 second')::DATE AS converted_date,\n        type\n    FROM \"integrity-db\".\"hubspot\".\"email_events\"\n)\n\nSELECT\n    converted_date,\n    sum(case when type = 'SENT' then 1 else 0 end) as sent_emails,\n    sum(case when type = 'OPEN' then 1 else 0 end) as opened_emails,\n    sum(case when type = 'CLICK' then 1 else 0 end) as clicks,\n    sum(case when type = 'BOUNCE' then 1 else 0 end) as bounces,\n    sum(case when type = 'SPAMREPORT' then 1 else 0 end) as spam_reports\nfrom hubspot_daily\ngroup by converted_date", "relation_name": "\"integrity-db\".\"prod_dbt-base\".\"hubspot_daily_base\"", "batch_results": null}, {"status": "success", "timing": [{"name": "compile", "started_at": "2025-02-04T19:56:20.230723Z", "completed_at": "2025-02-04T19:56:20.245712Z"}, {"name": "execute", "started_at": "2025-02-04T19:56:20.247200Z", "completed_at": "2025-02-04T19:56:26.371252Z"}], "thread_id": "Thread-1 (worker)", "execution_time": 6.7056965827941895, "adapter_response": {"_message": "SUCCESS", "rows_affected": -1}, "message": "SUCCESS", "failures": null, "unique_id": "model.integrity_energy_dbt.bing_ads_daily_base", "compiled": true, "compiled_code": "\n\nselect\n    spend,\n    impressions,\n    clicks,\n    timeperiod,\n    adgroupname,\n    campaignname\nfrom \"integrity-db\".\"bing_ads\".\"ad_performance_report_daily\"", "relation_name": "\"integrity-db\".\"prod_dbt-base\".\"bing_ads_daily_base\"", "batch_results": null}, {"status": "success", "timing": [{"name": "compile", "started_at": "2025-02-04T19:56:20.236190Z", "completed_at": "2025-02-04T19:56:20.247200Z"}, {"name": "execute", "started_at": "2025-02-04T19:56:20.279483Z", "completed_at": "2025-02-04T19:56:26.865125Z"}], "thread_id": "Thread-2 (worker)", "execution_time": 6.717860698699951, "adapter_response": {"_message": "SUCCESS", "rows_affected": -1}, "message": "SUCCESS", "failures": null, "unique_id": "model.integrity_energy_dbt.facebook_daily_base", "compiled": true, "compiled_code": "\n\nselect\n    date_start, \n    sum(impressions) as facebook_impressions,\n    sum(reach) as facebook_reach,\n    sum(spend) as facebook_spend, \n    sum(clicks) as facebook_clicks,\n    sum(unique_clicks) as facebook_unique_clicks\nfrom \"integrity-db\".\"facebook\".\"ads_insights\"\ngroup by date_start", "relation_name": "\"integrity-db\".\"prod_dbt-base\".\"facebook_daily_base\"", "batch_results": null}, {"status": "success", "timing": [{"name": "compile", "started_at": "2025-02-04T19:56:22.565930Z", "completed_at": "2025-02-04T19:56:22.583229Z"}, {"name": "execute", "started_at": "2025-02-04T19:56:22.583229Z", "completed_at": "2025-02-04T19:56:28.750444Z"}], "thread_id": "Thread-3 (worker)", "execution_time": 6.25032901763916, "adapter_response": {"_message": "SUCCESS", "rows_affected": -1}, "message": "SUCCESS", "failures": null, "unique_id": "model.integrity_energy_dbt.marketing_cost_base", "compiled": true, "compiled_code": "\n\nselect\n    team,\n    CAST(month as date) as month,\n    CAST(REPLACE(hom_cost, ',', '') as decimal(10,2)) as hom_cost,\n    CAST(REPLACE(ipr_cost, ',', '')  as decimal(10,2)) as ipr_cost,\n    CAST(REPLACE(copywriter, ',', '') as decimal(10,2)) as copywriter,\n    CAST(REPLACE(dango_costs, ',', '') as decimal(10,2)) as dango_costs,\n    CAST(REPLACE(designer_costs, ',', '') as decimal(10,2)) as designer_costs,\n    CAST(REPLACE(paid_lead_cost, ',', '') as decimal(10,2)) as paid_lead_cost,\n    CAST(REPLACE(data_contractor, ',', '') as decimal(10,2)) as data_contractor,\n    CAST(REPLACE(seo_lead_salary, ',', '') as decimal(10,2)) as seo_lead_salary,\n    CAST(REPLACE(contractor_costs, ',', '') as decimal(10,2)) as contractor_costs,\n    CAST(REPLACE(paid_agency_cost, ',', '') as decimal(10,2)) as paid_agency_cost,\n    CAST(REPLACE(paid_support_cost, ',', '') as decimal(10,2)) as paid_support_cost,\n    CAST(REPLACE(project_management, ',', '') as decimal(10,2)) as project_management,\n    CAST(REPLACE(crowd_content_costs, ',', '') as decimal(10,2)) as crowd_content_costs,\n    CAST(REPLACE(email_contractor_costs, ',', '') as decimal(10,2)) as email_contractor_costs,\n    CAST(REPLACE(hubspot_contractor_costs, ',', '') as decimal(10,2)) as hubspot_contractor_costs\nfrom \"integrity-db\".\"google_sheets\".\"monthly_cost\"", "relation_name": "\"integrity-db\".\"prod_dbt-base\".\"marketing_cost_base\"", "batch_results": null}, {"status": "success", "timing": [{"name": "compile", "started_at": "2025-02-04T19:56:26.952080Z", "completed_at": "2025-02-04T19:56:26.961658Z"}, {"name": "execute", "started_at": "2025-02-04T19:56:26.963837Z", "completed_at": "2025-02-04T19:56:32.167536Z"}], "thread_id": "Thread-4 (worker)", "execution_time": 5.303854465484619, "adapter_response": {"_message": "SUCCESS", "rows_affected": -1}, "message": "SUCCESS", "failures": null, "unique_id": "model.integrity_energy_dbt.salesforce_account_base", "compiled": true, "compiled_code": "\n\nselect\n    id,\n    name,\n    type,\n    phone,\n    industry,\n    billingcity,\n    billingcountry,\n    billingcountrycode,\n    billingpostalcode,\n    billingstreet,\n    main_phone__c\n    --utility_company__c\nfrom \"integrity-db\".\"salesforce\".\"account\"", "relation_name": "\"integrity-db\".\"prod_dbt-base\".\"salesforce_account_base\"", "batch_results": null}, {"status": "success", "timing": [{"name": "compile", "started_at": "2025-02-04T19:56:26.957292Z", "completed_at": "2025-02-04T19:56:26.965844Z"}, {"name": "execute", "started_at": "2025-02-04T19:56:26.965844Z", "completed_at": "2025-02-04T19:56:34.813187Z"}], "thread_id": "Thread-1 (worker)", "execution_time": 8.542673826217651, "adapter_response": {"_message": "SUCCESS", "rows_affected": -1}, "message": "SUCCESS", "failures": null, "unique_id": "model.integrity_energy_dbt.salesforce_contact_base", "compiled": true, "compiled_code": "\n\nWITH base AS (\n\n    SELECT\n        id,\n        name,\n        LOWER(TRIM(email)) AS email,\n        REGEXP_REPLACE(phone, '[- ]', '') AS phone,\n        REGEXP_REPLACE(mobilephone, '[- ]', '') AS mobilephone,\n        REGEXP_REPLACE(main_phone__c, '[- ]', '') AS main_phone__c,\n        title,\n        createddate,\n        mailingcity,\n        mailingstate,\n        mailingstatecode,\n        mailingcountry,\n        accountid,\n        rep_last_first__c,\n        lastname,\n        firstname,\n        department,\n        customer_account_number__c,\n        contract_signer_phone_email__c,\n        reportstoid,\n        ROW_NUMBER() OVER (\n          PARTITION BY\n            REGEXP_REPLACE(phone, '[- ]', ''), -- Remove spaces and hyphens from phone numbers\n            LOWER(TRIM(email)), -- Normalize email by converting to lowercase\n            LOWER(TRIM(name)) -- Normalize name by converting to lowercase\n          ORDER BY\n            COALESCE(lastactivitydate, createddate) DESC -- Order by last activity date or created date\n        ) AS rn\n    FROM\n        \"integrity-db\".\"salesforce\".\"contact\"\n\n)\n\nSELECT\n    id,\n    name,\n    email,\n    phone,\n    mobilephone,\n    main_phone__c,\n    title,\n    createddate,\n    mailingcity,\n    mailingstate,\n    mailingstatecode,\n    mailingcountry,\n    accountid,\n    reportstoid,\n    rep_last_first__c,\n    customer_account_number__c,\n    contract_signer_phone_email__c,\n    lastname,\n    firstname,\n    department\nFROM\n    base\nWHERE\n    rn = 1", "relation_name": "\"integrity-db\".\"prod_dbt-base\".\"salesforce_contact_base\"", "batch_results": null}, {"status": "success", "timing": [{"name": "compile", "started_at": "2025-02-04T19:56:28.816260Z", "completed_at": "2025-02-04T19:56:28.833176Z"}, {"name": "execute", "started_at": "2025-02-04T19:56:28.833176Z", "completed_at": "2025-02-04T19:56:35.423597Z"}], "thread_id": "Thread-3 (worker)", "execution_time": 6.679495096206665, "adapter_response": {"_message": "SUCCESS", "rows_affected": -1}, "message": "SUCCESS", "failures": null, "unique_id": "model.integrity_energy_dbt.salesforce_meter_number_base", "compiled": true, "compiled_code": "\n\nselect\n    id,\n    name,\n    city__c,\n    state__c,\n    street__c,\n    zip_code__c,\n    mils__c,\n    commodity__c,\n    createddate,\n    service_address__c,\n    status__c,\n    account__c,\n    dl_account__c,\n    account_number__c\nfrom \"integrity-db\".\"salesforce\".\"meter_number__c\"", "relation_name": "\"integrity-db\".\"prod_dbt-base\".\"salesforce_meter_number_base\"", "batch_results": null}, {"status": "success", "timing": [{"name": "compile", "started_at": "2025-02-04T19:56:26.965844Z", "completed_at": "2025-02-04T19:56:26.976504Z"}, {"name": "execute", "started_at": "2025-02-04T19:56:26.976504Z", "completed_at": "2025-02-04T19:56:39.585298Z"}], "thread_id": "Thread-2 (worker)", "execution_time": 12.696374654769897, "adapter_response": {"_message": "SUCCESS", "rows_affected": -1}, "message": "SUCCESS", "failures": null, "unique_id": "model.integrity_energy_dbt.salesforce_lead_base", "compiled": true, "compiled_code": "\n\nWITH base AS (\n\n    SELECT\n        id,\n        city,\n        name,\n        LOWER(TRIM(email)) AS email,\n        REGEXP_REPLACE(phone, '[- ]', '') AS phone,\n        state,\n        title,\n        status,\n        street,\n        company,\n        country,\n        LOWER(TRIM(REGEXP_REPLACE(firstname, '[^a-zA-Z]', ''))) AS firstname,\n        LOWER(TRIM(REGEXP_REPLACE(lastname, '[^a-zA-Z]', ''))) AS lastname,\n        source__c,\n        channel__c,\n        leadsource,\n        postalcode,\n        createddate,\n        CAST(createddate AS DATE) AS createdday,\n        isconverted,\n        commodity__c,\n        converteddate,\n        lastactivitydate,\n        convertedaccountid,\n        convertedcontactid,\n        lead_id_for_opp__c,\n        average_bill_amount__c,\n        convertedopportunityid,\n        converted_from_lead__c,\n        marketing_generator__c,\n        new_ready_to_work_date__c,\n        last_activity_note_date__c,\n        ROW_NUMBER() OVER (\n          PARTITION BY\n            REGEXP_REPLACE(phone, '[- ]', ''), -- Remove spaces and hyphens from phone numbers\n            LOWER(TRIM(email)), -- Normalize email by converting to lowercase\n            LOWER(TRIM(REGEXP_REPLACE(firstname, '[^a-zA-Z]', ''))),\n            LOWER(TRIM(REGEXP_REPLACE(lastname, '[^a-zA-Z]', '')))\n          ORDER BY\n            COALESCE(lastactivitydate, createddate) DESC -- Order by last activity date or created date\n        ) AS rn\n    FROM\n        \"integrity-db\".\"salesforce\".\"lead\"\n\n)\n\nSELECT\n    id,\n    city,\n    name,\n    email,\n    phone,\n    state,\n    title,\n    status,\n    street,\n    company,\n    country,\n    firstname,\n    lastname,\n    source__c,\n    channel__c,\n    leadsource,\n    postalcode,\n    createddate,\n    createdday,\n    isconverted,\n    commodity__c,\n    converteddate,\n    lastactivitydate,\n    convertedaccountid,\n    convertedcontactid,\n    lead_id_for_opp__c,\n    average_bill_amount__c,\n    convertedopportunityid,\n    converted_from_lead__c,\n    marketing_generator__c,\n    new_ready_to_work_date__c,\n    last_activity_note_date__c\nFROM\n    base\nWHERE\n    rn = 1", "relation_name": "\"integrity-db\".\"prod_dbt-base\".\"salesforce_lead_base\"", "batch_results": null}, {"status": "success", "timing": [{"name": "compile", "started_at": "2025-02-04T19:56:35.504406Z", "completed_at": "2025-02-04T19:56:35.512075Z"}, {"name": "execute", "started_at": "2025-02-04T19:56:35.518171Z", "completed_at": "2025-02-04T19:56:44.106697Z"}], "thread_id": "Thread-1 (worker)", "execution_time": 9.200959205627441, "adapter_response": {"_message": "SUCCESS", "rows_affected": -1}, "message": "SUCCESS", "failures": null, "unique_id": "model.integrity_energy_dbt.utility_lead_base", "compiled": true, "compiled_code": "\n\nWITH utilitylead_base AS (\n\n    SELECT\n        companyname,\n        serviceaddress,\n        servicecity,\n        servicestate,\n        servicezip,\n        utility,\n        accountnumber,\n        annualusage,\n        ratecode,\n        ROW_NUMBER() OVER (\n          PARTITION BY\n            companyname, serviceaddress, utility, servicecity, servicestate, ratecode\n          ORDER BY\n            _airbyte_extracted_at DESC\n        ) AS rn\n    FROM\n        \"integrity-db\".\"utility_leads\".\"utilitylead\"\n\n),\n\nenriched_base AS (\n\n    SELECT\n        \"eru lastname\" as lastname,\n        \"eru firstname\" as firstname,\n        \"eru titledesc\" as title,\n        \"be telephone number10\" as phone,\n        \"bee email addr80\" as email,\n        companyname,\n        serviceaddress,\n        utility,\n        servicecity,\n        servicestate,\n        ratecode\n    FROM\n        \"integrity-db\".\"utility_leads\".\"enriched\"\n\n)\n\n\nselect\n        u.companyname,\n        u.serviceaddress,\n        u.servicecity,\n        u.servicestate,\n        u.servicezip,\n        u.utility,\n        u.accountnumber,\n        u.annualusage,\n        u.ratecode,\n        REGEXP_REPLACE(e.lastname, '[^a-zA-Z]', '') AS lastname,\n        REGEXP_REPLACE(e.firstname, '[^a-zA-Z]', '') AS firstname,\n        e.title,\n        REGEXP_REPLACE(e.phone, '[- ]', '') AS phone,\n        LOWER(TRIM(e.email)) AS email,\nFROM\n    utilitylead_base AS u\n    LEFT JOIN enriched_base AS e\n        ON u.companyname = e.companyname\n            AND u.serviceaddress = e.serviceaddress\n            AND u.utility = e.utility\n            AND u.servicecity = e.servicecity\n            AND u.servicestate = e.servicestate\n            AND u.ratecode = e.ratecode\nWHERE\n    u.rn = 1\nGROUP BY\n    1,2,3,4,5,6,7,8,9,10,11,12,13,14", "relation_name": "\"integrity-db\".\"prod_dbt-base\".\"utility_lead_base\"", "batch_results": null}, {"status": "success", "timing": [{"name": "compile", "started_at": "2025-02-04T19:56:35.508076Z", "completed_at": "2025-02-04T19:56:35.512075Z"}, {"name": "execute", "started_at": "2025-02-04T19:56:35.513174Z", "completed_at": "2025-02-04T19:56:44.622338Z"}], "thread_id": "Thread-3 (worker)", "execution_time": 9.200959205627441, "adapter_response": {"_message": "SUCCESS", "rows_affected": -1}, "message": "SUCCESS", "failures": null, "unique_id": "model.integrity_energy_dbt.zoominfo_base", "compiled": true, "compiled_code": "\n\nselect\n    *\nfrom\n    \"integrity-db\".\"zoominfo\".\"zoominfo_upload_09202024\"", "relation_name": "\"integrity-db\".\"prod_dbt-base\".\"zoominfo_base\"", "batch_results": null}, {"status": "success", "timing": [{"name": "compile", "started_at": "2025-02-04T19:56:32.248227Z", "completed_at": "2025-02-04T19:56:32.248227Z"}, {"name": "execute", "started_at": "2025-02-04T19:56:32.248227Z", "completed_at": "2025-02-04T19:56:46.434755Z"}], "thread_id": "Thread-4 (worker)", "execution_time": 14.263991117477417, "adapter_response": {"_message": "SUCCESS", "rows_affected": -1}, "message": "SUCCESS", "failures": null, "unique_id": "model.integrity_energy_dbt.salesforce_opportunity_base", "compiled": true, "compiled_code": "\n\nWITH base AS (\n\n    SELECT\n        id,\n        name,\n        type,\n        iswon,\n        fiscal,\n        mils__c,\n        ownerid,\n        rate__c,\n        term__c,\n        team__c,\n        source__c,\n        marketing_generator__c,\n        isclosed,\n        notes__c,\n        accountid,\n        csdate__c,\n        closedate,\n        driver__c,\n        meters__c,\n        points__c,\n        stagename,\n        status__c,\n        channel__c,\n        dl_2000__c,\n        dl_4000__c,\n        dl_6000__c,\n        leadsource,\n        manager__c,\n        re_sold__c,\n        renewed__c,\n        createddate,\n        residual__c,\n        sp_rt_id__c,\n        subagent__c,\n        supplier__c,\n        commodity__c,\n        rate_type__c,\n        sp_points__c,\n        sold_date__c,\n        broker_fee__c,\n        cancel_fee__c,\n        usage_type__c,\n        cancel_date__c,\n        dl_1500_kwh__c,\n        dl_2500_kwh__c,\n        dl_3500_kwh__c,\n        dl_rate_gas__c,\n        dl_term_gas__c,\n        dl_owner_alias__c,\n        lost_reason__c,\n        meter_usage__c,\n        owner_title__c,\n        real_points__c,\n        total_usage__c,\n        dl_start_gas__c,\n        dl_usage_gas__c,\n        do_not_renew__c,\n        renewal_date__c,\n        sales_person__c,\n        total_points__c,\n        utility_text__c,\n        sales_manager__c,\n        supplier_text__c,\n        agent_takeback__c,\n        canceled_usage__c,\n        commodity_text__c,\n        contract_signer__c,\n        cancelled_points__c,\n        supplier_credits__c,\n        commission_matrix__c,\n        contract_end_date__c,\n        broker_fee_rounded__c,\n        commission_percent__c,\n        last_activity_note__c,\n        confirmation_number__c,\n        contract_start_date__c,\n        contract_signer_email__c,\n        contract_signer_phone_email__c,\n--        contract_signer_facilitator__c,\n        ROW_NUMBER() OVER (\n          PARTITION BY\n            id\n          ORDER BY\n            COALESCE(lastactivitydate, createddate) DESC -- Order by last activity date or created date\n        ) AS rn\n    FROM\n        \"integrity-db\".\"salesforce\".\"opportunity\"\n\n)\n\nSELECT\n    id,\n    name,\n    type,\n    iswon,\n    fiscal,\n    mils__c,\n    ownerid,\n    rate__c,\n    term__c,\n    team__c,\n    source__c,\n    marketing_generator__c,\n    isclosed,\n    notes__c,\n    accountid,\n    csdate__c,\n    closedate,\n    driver__c,\n    meters__c,\n    points__c,\n    stagename,\n    status__c,\n    channel__c,\n    dl_2000__c,\n    dl_4000__c,\n    dl_6000__c,\n    leadsource,\n    manager__c,\n    re_sold__c,\n    renewed__c,\n    createddate,\n    residual__c,\n    sp_rt_id__c,\n    subagent__c,\n    supplier__c,\n    commodity__c,\n    rate_type__c,\n    sp_points__c,\n    sold_date__c,\n    broker_fee__c,\n    cancel_fee__c,\n    usage_type__c,\n    cancel_date__c,\n    dl_1500_kwh__c,\n    dl_2500_kwh__c,\n    dl_3500_kwh__c,\n    dl_rate_gas__c,\n    dl_term_gas__c,\n    dl_owner_alias__c,\n    lost_reason__c,\n    meter_usage__c,\n    owner_title__c,\n    real_points__c,\n    total_usage__c,\n    dl_start_gas__c,\n    dl_usage_gas__c,\n    do_not_renew__c,\n    renewal_date__c,\n    sales_person__c,\n    total_points__c,\n    utility_text__c,\n    sales_manager__c,\n    supplier_text__c,\n    agent_takeback__c,\n    canceled_usage__c,\n    commodity_text__c,\n    contract_signer__c,\n    cancelled_points__c,\n    supplier_credits__c,\n    commission_matrix__c,\n    contract_end_date__c,\n    broker_fee_rounded__c,\n    commission_percent__c,\n    last_activity_note__c,\n    confirmation_number__c,\n    contract_start_date__c,\n    contract_signer_email__c,\n    contract_signer_phone_email__c\n--    contract_signer_facilitator__c\nFROM\n    base\nWHERE\n    rn = 1", "relation_name": "\"integrity-db\".\"prod_dbt-base\".\"salesforce_opportunity_base\"", "batch_results": null}, {"status": "success", "timing": [{"name": "compile", "started_at": "2025-02-04T19:56:44.703191Z", "completed_at": "2025-02-04T19:56:44.717641Z"}, {"name": "execute", "started_at": "2025-02-04T19:56:44.718650Z", "completed_at": "2025-02-04T19:56:48.151479Z"}], "thread_id": "Thread-1 (worker)", "execution_time": 4.1047093868255615, "adapter_response": {"_message": "SUCCESS", "rows_affected": -1}, "message": "SUCCESS", "failures": null, "unique_id": "model.integrity_energy_dbt.utility_lead_intermediate", "compiled": true, "compiled_code": "\n\nwith meter_number as (\n    select\n        id,\n        name,\n        city__c,\n        state__c,\n        street__c,\n        zip_code__c,\n        mils__c,\n        commodity__c,\n        createddate,\n        service_address__c,\n        status__c,\n        account__c\n    from \"integrity-db\".\"prod_dbt-base\".\"salesforce_meter_number_base\"\n),\n\naccount as (\n    select\n        id,\n        name,\n        type,\n        phone,\n        industry,\n        billingcity,\n        billingcountry,\n        billingcountrycode,\n        billingpostalcode,\n        billingstreet,\n        main_phone__c\n    from \"integrity-db\".\"prod_dbt-base\".\"salesforce_account_base\"\n),\n\nutility_leads as (\n    select\n        companyname,\n        serviceaddress,\n        servicecity,\n        servicestate,\n        servicezip,\n        utility,\n        accountnumber,\n        annualusage,\n        ratecode,\n        lastname,\n        firstname,\n        title,\n        phone,\n        email\n    from \"integrity-db\".\"prod_dbt-base\".\"utility_lead_base\"\n)\n\nselect\n    m.id as meter_number_id,\n    MIN(m.name) as meter_number_name,\n    MIN(m.city__c) as meter_number_city,\n    MIN(m.state__c) as meter_number_state,\n    MIN(m.street__c) as meter_number_street,\n    MIN(m.zip_code__c) as meter_number_zip_code,\n    MIN(m.mils__c) as meter_number_mils,\n    MIN(m.commodity__c) as meter_number_commodity,\n    MIN(m.createddate) as meter_number_createddate,\n    MIN(m.service_address__c) as meter_number_service_address,\n    MIN(m.status__c) as meter_number_status,\n    MIN(m.account__c) as meter_number_account_id,\n    MIN(a.id) as account_id,\n    MIN(a.name) as account_name,\n    MIN(a.type) as account_type,\n    MIN(a.phone) as account_phone,\n    MIN(a.industry) as account_industry,\n    MIN(a.billingcity) as account_billingcity,\n    MIN(a.billingcountry) as account_billingcountry,\n    MIN(a.billingcountrycode) as account_billingcountrycode,\n    MIN(a.billingpostalcode) as account_billingpostalcode,\n    MIN(a.billingstreet) as account_billingstreet,\n    MIN(a.main_phone__c) as account_main_phone,\n    MIN(u.companyname) as utility_companyname,\n    MIN(u.serviceaddress) as utility_serviceaddress,\n    MIN(u.servicecity) as utility_servicecity,\n    MIN(u.servicestate) as utility_servicestate,\n    MIN(u.servicezip) as utility_servicezip,\n    MIN(u.utility) as utility_utility,\n    MIN(u.accountnumber) as utility_accountnumber,\n    MIN(u.annualusage) as utility_annualusage,\n    MIN(u.ratecode) as utility_ratecode,\n    MIN(u.firstname) as utility_firstname,\n    MIN(u.lastname) as utility_lastname,\n    MIN(u.title) as utility_title,\n    MIN(u.phone) as utility_phone,\n    MIN(u.email) as utility_email\nfrom meter_number as m\nleft join account as a on m.account__c = a.id\nleft join utility_leads as u \non \n    (trim(lower(a.name)) = trim(lower(u.companyname)) AND\n    trim(m.zip_code__c) = trim(u.servicezip) AND\n    trim(lower(m.city__c)) = trim(lower(u.servicecity)) AND\n    regexp_substr(m.street__c, '^[0-9]+') = regexp_substr(u.serviceaddress, '^[0-9]+'))\n    --OR (trim(lower(m.street__c)) = trim(lower(u.serviceaddress)))\ngroup by m.id", "relation_name": "\"integrity-db\".\"prod_dbt-intermediate\".\"utility_lead_intermediate\"", "batch_results": null}, {"status": "success", "timing": [{"name": "compile", "started_at": "2025-02-04T19:56:39.659387Z", "completed_at": "2025-02-04T19:56:39.662901Z"}, {"name": "execute", "started_at": "2025-02-04T19:56:39.663909Z", "completed_at": "2025-02-04T19:56:48.728616Z"}], "thread_id": "Thread-2 (worker)", "execution_time": 9.152624607086182, "adapter_response": {"_message": "SUCCESS", "rows_affected": -1}, "message": "SUCCESS", "failures": null, "unique_id": "model.integrity_energy_dbt.sales_renewal_dash", "compiled": true, "compiled_code": "\n\n-- Step 1: Select from the `contact` table in the Salesforce schema\nWITH salesforce_contact AS (\n\n    SELECT\n        *\n    FROM\n        \"integrity-db\".\"prod_dbt-base\".\"salesforce_contact_base\"\n\n),\n\n-- Step 2: Remove unnecessary columns\ncontact_filtered AS (\n\n    SELECT\n        id\n        ,reportstoid\n        ,name\n        ,lastname\n        ,department\n    FROM\n        salesforce_contact\n\n),\n\n-- Step 3: Perform a LEFT JOIN on `reportstoid` and `id` within the same dataset\nmerged_contacts AS (\n\n    SELECT\n        cf.*\n        ,rc.name AS rc_name\n        ,rc.lastname AS rc_lastname\n    FROM\n        contact_filtered cf\n        LEFT JOIN contact_filtered rc\n            ON cf.reportstoid = rc.id\n\n),\n\n-- Step 4: Add a new column with a static value (\"Team\")\nadded_custom_column AS (\n\n    SELECT\n        *\n        ,CAST('Team' AS VARCHAR) AS team_prefix\n    FROM\n        merged_contacts\n\n),\n\n-- Step 5: Filter rows where `Removed Columns.lastname` is not NULL\nfiltered_rows AS (\n\n    SELECT\n        *\n    FROM\n        added_custom_column\n    WHERE\n        rc_lastname IS NOT NULL\n\n),\n\n-- Step 6: Combine the \"Team Prefix\" and \"Removed Columns.lastname\" columns into a new column\nmerged_columns AS (\n\n    SELECT\n        *\n        ,team_prefix || ' ' || rc_lastname AS team\n    FROM\n        filtered_rows\n\n),\n\n-- Step 7: Replace specific values in the \"Team\" column\nreplaced_value AS (\n\n    SELECT\n        *\n        ,CASE\n           WHEN team = 'Team Leads' THEN 'Website Leads'\n           ELSE team\n        END AS team_updated\n    FROM\n        merged_columns\n\n),\n\n-- Step 8: Duplicate the \"department\" column and rename it\nduplicated_column AS (\n\n    SELECT\n        *\n        ,department AS renewals_distinction\n    FROM\n        replaced_value\n\n),\n\n-- Step 9: Replace values in the \"Renewals Distinction\" column\nupdated_renewals AS (\n\n    SELECT\n        *\n        ,CASE\n           WHEN renewals_distinction = 'Lead Generator'\n            THEN 'Inside Sales'\n           WHEN renewals_distinction = 'New Sales'\n            THEN 'Inside Sales'\n           WHEN renewals_distinction = 'Sub Agent'\n            THEN 'SubAgent'\n           WHEN renewals_distinction = 'Renewals'\n            THEN 'Inside Sales'\n           WHEN renewals_distinction = 'Sales Director'\n            THEN 'Inside Sales'\n           WHEN renewals_distinction = 'Retention'\n            THEN 'Inside Sales'\n           ELSE renewals_distinction\n        END AS renewals_distinction_Updated\n    FROM\n        duplicated_column\n\n)\n\n-- Step 10: Select final filtered rows\nSELECT\n    *\nFROM\n    updated_renewals", "relation_name": "\"integrity-db\".\"prod_dbt-intermediate\".\"sales_renewal_dash\"", "batch_results": null}, {"status": "success", "timing": [{"name": "compile", "started_at": "2025-02-04T19:56:46.524219Z", "completed_at": "2025-02-04T19:56:46.529220Z"}, {"name": "execute", "started_at": "2025-02-04T19:56:46.533217Z", "completed_at": "2025-02-04T19:56:49.909614Z"}], "thread_id": "Thread-4 (worker)", "execution_time": 4.010777711868286, "adapter_response": {"_message": "SUCCESS", "rows_affected": -1}, "message": "SUCCESS", "failures": null, "unique_id": "model.integrity_energy_dbt.lead_intermediate", "compiled": true, "compiled_code": "\n\nwith salesforce_leads as (\n    select\n        id as lead_id,\n        city as lead_city,\n        name as lead_name,\n        email as lead_email,\n        phone as lead_phone,\n        state as lead_state,\n        title as lead_title,\n        status as lead_status,\n        street as lead_street,\n        company as lead_company,\n        country as lead_country,\n        firstname as lead_firstname,\n        lastname as lead_lastname,\n        source__c as lead_source,\n        channel__c as lead_channel,\n        leadsource as lead_leadsource,\n        postalcode as lead_postalcode,\n        createddate as lead_createddate,\n        createdday as lead_createdday,\n        isconverted as lead_isconverted,\n        commodity__c as lead_commodity,\n        converteddate as lead_converteddate,\n        lastactivitydate as lead_lastactivitydate,\n        convertedaccountid as lead_convertedaccountid,\n        convertedcontactid as lead_convertedcontactid,\n        average_bill_amount__c as lead_average_bill_amount,\n        convertedopportunityid as lead_convertedopportunityid,\n        marketing_generator__c as lead_marketing_generator,\n        new_ready_to_work_date__c as lead_new_ready_to_work_date,\n        Concat(company,regexp_substr(street, '^[0-9]+')) as util_join\n    from \"integrity-db\".\"prod_dbt-base\".\"salesforce_lead_base\"\n),\n\nsalesforce_contacts as (\n    select\n        id as contact_id,\n        name as contact_name,\n        email as contact_email,\n        phone as contact_phone,\n        mobilephone as contact_mobilephone,\n        main_phone__c as contact_mainphone,\n        title as contact_title,\n        createddate as contact_createddate,\n        mailingcity as contact_mailingcity,\n        mailingstate as contact_mailingstate,\n        mailingstatecode as contact_mailingstatecode,\n        mailingcountry as contact_mailingcountry,\n        accountid as contact_accountid,\n        rep_last_first__c as contact_rep_last_first,\n        customer_account_number__c as contact_customer_account_number,\n        contract_signer_phone_email__c as contact_contract_signer_phone_email\n    from \"integrity-db\".\"prod_dbt-base\".\"salesforce_contact_base\"\n),\n\nsalesforce_opportunities as (\n    select\n        contract_signer__c as opp_contract_signer,\n        count(distinct(id)) as total_opportunities,\n        sum((case when iswon = true then 1 else 0 end)) as won_opportunities,\n        sum((case when iswon = true then points__c else 0 end)) as won_points,\n        sum((case when iswon = false and isclosed = true then 1 else 0 end)) as lost_opportunities,\n        sum((case when isclosed = false then 1 else 0 end)) as open_opportunities,\n        sum((case when isclosed = true then 1 else 0 end)) as closed_opportunities\n    from \"integrity-db\".\"prod_dbt-base\".\"salesforce_opportunity_base\"\n    group by opp_contract_signer\n),\n\nutility_lead as (\n    select\n        companyname as utility_companyname,\n        serviceaddress as utility_serviceaddress,\n        servicecity as utility_servicecity,\n        servicezip as utility_servicezip,\n        phone as utility_phone,\n        Concat(companyname,regexp_substr(serviceaddress, '^[0-9]+')) as lead_join\n    from \"integrity-db\".\"prod_dbt-base\".\"utility_lead_base\"\n)\n\nselect\n(NVL(l.lead_id,'-') || NVL(c.contact_id,'-') || NVL(u.lead_join,'-')) as lead_master_id,\n*\nfrom salesforce_leads as l\nfull join salesforce_contacts as c on l.lead_convertedcontactid = c.contact_id\nfull join utility_lead as u on l.util_join = u.lead_join\nleft join salesforce_opportunities as o on c.contact_id = o.opp_contract_signer", "relation_name": "\"integrity-db\".\"prod_dbt-intermediate\".\"lead_intermediate\"", "batch_results": null}, {"status": "success", "timing": [{"name": "compile", "started_at": "2025-02-04T19:56:46.520218Z", "completed_at": "2025-02-04T19:56:46.529220Z"}, {"name": "execute", "started_at": "2025-02-04T19:56:46.530218Z", "completed_at": "2025-02-04T19:56:50.466687Z"}], "thread_id": "Thread-3 (worker)", "execution_time": 4.028797626495361, "adapter_response": {"_message": "SUCCESS", "rows_affected": -1}, "message": "SUCCESS", "failures": null, "unique_id": "model.integrity_energy_dbt.deal_intermediate", "compiled": true, "compiled_code": "\n\nwith salesforce_opportunities as (\n    select\n        id,\n        name,\n        type,\n        iswon,\n        fiscal,\n        mils__c,\n        ownerid,\n        rate__c,\n        term__c,\n        team__c,\n        source__c,\n        marketing_generator__c,\n        isclosed,\n        notes__c,\n        accountid,\n        csdate__c,\n        closedate,\n        driver__c,\n        meters__c,\n        points__c,\n        stagename,\n        status__c,\n        channel__c,\n        leadsource,\n        manager__c,\n        re_sold__c,\n        renewed__c,\n        createddate,\n        residual__c,\n        sp_rt_id__c,\n        subagent__c,\n        supplier__c,\n        commodity__c,\n        rate_type__c,\n        sp_points__c,\n        sold_date__c,\n        broker_fee__c,\n        cancel_fee__c,\n        usage_type__c,\n        cancel_date__c,\n        dl_rate_gas__c,\n        dl_owner_alias__c,\n        dl_term_gas__c,\n        lost_reason__c,\n        meter_usage__c,\n        owner_title__c,\n        real_points__c,\n        total_usage__c,\n        dl_start_gas__c,\n        dl_usage_gas__c,\n        do_not_renew__c,\n        renewal_date__c,\n        sales_person__c,\n        total_points__c,\n        utility_text__c,\n        sales_manager__c,\n        supplier_text__c,\n        agent_takeback__c,\n        canceled_usage__c,\n        commodity_text__c,\n        contract_signer__c,\n        cancelled_points__c,\n        supplier_credits__c,\n        commission_matrix__c,\n        contract_end_date__c,\n        broker_fee_rounded__c,\n        commission_percent__c,\n        last_activity_note__c,\n        confirmation_number__c,\n        contract_start_date__c,\n        contract_signer_email__c,\n        contract_signer_phone_email__c\n--        contract_signer_facilitator__c\n    from \"integrity-db\".\"prod_dbt-base\".\"salesforce_opportunity_base\"\n),\n\nsalesforce_contacts as (\n    select\n        id as contact_id,\n        name as contact_name,\n        email as contact_email,\n        phone as contact_phone,\n        mobilephone as contact_mobilephone,\n        main_phone__c as contact_mainphone,\n        title as contact_title,\n        createddate as contact_createddate,\n        mailingcity as contact_mailingcity,\n        mailingstate as contact_mailingstate,\n        mailingstatecode as contact_mailingstatecode,\n        mailingcountry as contact_mailingcountry,\n        accountid as contact_accountid,\n        rep_last_first__c as contact_rep_last_first,\n        customer_account_number__c as contact_customer_account_number,\n        contract_signer_phone_email__c as contact_contract_signer_phone_email\n    from \"integrity-db\".\"prod_dbt-base\".\"salesforce_contact_base\"\n),\n\nsalesforce_leads as (\n    select\n        id as lead_id,\n        city as lead_city,\n        name as lead_name,\n        email as lead_email,\n        phone as lead_phone,\n        state as lead_state,\n        title as lead_title,\n        status as lead_status,\n        street as lead_street,\n        company as lead_company,\n        country as lead_country,\n        firstname as lead_firstname,\n        lastname as lead_lastname,\n        source__c as lead_source,\n        channel__c as lead_channel,\n        leadsource as lead_leadsource,\n        postalcode as lead_postalcode,\n        createddate as lead_createddate,\n        isconverted as lead_isconverted,\n        commodity__c as lead_commodity,\n        converteddate as lead_converteddate,\n        lastactivitydate as lead_lastactivitydate,\n        convertedaccountid as lead_convertedaccountid,\n        convertedcontactid as lead_convertedcontactid,\n        average_bill_amount__c as lead_average_bill_amount,\n        convertedopportunityid as lead_convertedopportunityid,\n        marketing_generator__c as lead_marketing_generator,\n        new_ready_to_work_date__c as lead_new_ready_to_work_date\n    from \"integrity-db\".\"prod_dbt-base\".\"salesforce_lead_base\"\n)\n\nselect\n*\nfrom salesforce_opportunities as o\nleft join salesforce_leads as l on l.lead_convertedcontactid = o.contract_signer__c\nleft join salesforce_contacts as c on c.contact_id = o.contract_signer__c", "relation_name": "\"integrity-db\".\"prod_dbt-intermediate\".\"deal_intermediate\"", "batch_results": null}, {"status": "success", "timing": [{"name": "compile", "started_at": "2025-02-04T19:56:48.812105Z", "completed_at": "2025-02-04T19:56:48.823641Z"}, {"name": "execute", "started_at": "2025-02-04T19:56:48.823641Z", "completed_at": "2025-02-04T19:56:54.403291Z"}], "thread_id": "Thread-1 (worker)", "execution_time": 5.655172824859619, "adapter_response": {"_message": "SUCCESS", "rows_affected": -1}, "message": "SUCCESS", "failures": null, "unique_id": "model.integrity_energy_dbt.marketing_intermediate", "compiled": true, "compiled_code": "\n\nwith google_ads as (\n    select\n        activity_date,\n        sum(googleads_impressions) as googleads_impressions,\n        ROUND((sum(googleads_cost) / 1000000),2) as googleads_cost,\n        sum(googleads_clicks) as googleads_clicks\n    from \"integrity-db\".\"prod_dbt-base\".\"google_ads_daily_base\"\n    group by activity_date\n),\n\nbing_ads as (\n    select\n        timeperiod,\n        sum(spend) as bing_spend,\n        sum(impressions) as bing_impressions,\n        sum(clicks) as bing_clicks\n    from \"integrity-db\".\"prod_dbt-base\".\"bing_ads_daily_base\"\n    group by timeperiod\n),\n\nhubspot as (\n    select\n        converted_date,\n        sent_emails as hubspot_sent_emails,\n        opened_emails as hubspot_opened_emails,\n        clicks as hubspot_clicks,\n        bounces as hubspot_bounces,\n        spam_reports as hubspot_spam_reports\n    from \"integrity-db\".\"prod_dbt-base\".\"hubspot_daily_base\"\n),\n\nfacebook as (\n    select\n        date_start,\n        facebook_impressions,\n        facebook_reach,\n        facebook_spend,\n        facebook_clicks,\n        facebook_unique_clicks\n    from \"integrity-db\".\"prod_dbt-base\".\"facebook_daily_base\"\n),\n\nopportunity_sold as (\n    SELECT\n    sold_date__c,\n    sum(case when iswon = true and status__c <> 'Cancelled' then 1 else 0 end) as total_won_opportunities,\n    sum(case when iswon = true and status__c <> 'Cancelled' then points__c else 0 end) as total_won_points,\n    sum(case when iswon = true and status__c <> 'Cancelled' and team__c = 'Paid' then 1 else 0 end) as paid_won_opportunities,\n    sum(case when iswon = true and status__c <> 'Cancelled' and team__c = 'Paid' then points__c else 0 end) as paid_won_points,\n    sum(case when iswon = true and status__c <> 'Cancelled' and team__c = 'Earned' then 1 else 0 end) as earned_won_opportunities,\n    sum(case when iswon = true and status__c <> 'Cancelled' and team__c = 'Earned' then points__c else 0 end) as earned_won_points,\n    sum(case when iswon = true and status__c <> 'Cancelled' and team__c = 'Owned' then 1 else 0 end) as owned_won_opportunities,\n    sum(case when iswon = true and status__c <> 'Cancelled' and team__c = 'Owned' then points__c else 0 end) as owned_won_points,\n    sum(case when iswon = true and status__c <> 'Cancelled' and source__c = 'Google' then 1 else 0 end) as google_won_opportunities,\n    sum(case when iswon = true and status__c <> 'Cancelled' and source__c = 'Google' then points__c else 0 end) as google_won_points,\n    sum(case when iswon = true and status__c <> 'Cancelled' and source__c = 'Microsoft' then 1 else 0 end) as microsoft_won_opportunities,\n    sum(case when iswon = true and status__c <> 'Cancelled' and source__c = 'Microsoft' then points__c else 0 end) as microsoft_won_points,\n    sum(case when iswon = true and status__c <> 'Cancelled' and source__c = 'Email' then 1 else 0 end) as email_won_opportunities,\n    sum(case when iswon = true and status__c <> 'Cancelled' and source__c = 'Email' then points__c else 0 end) as email_won_points\nfrom \"integrity-db\".\"prod_dbt-base\".\"salesforce_opportunity_base\"\nwhere marketing_generator__c = '0035f00000G8KYcAAN'\ngroup by sold_date__c\n),\n\nopportunity_cancelled as (\nSELECT\n    cancel_date__c,\n    sum(case when iswon = true and status__c = 'Cancelled' then 1 else 0 end) as total_cancelled_opportunities,\n    sum(case when iswon = true and cancel_date__c <> NULL then cancelled_points__c else 0 end) as total_cancelled_points\nfrom \"integrity-db\".\"prod_dbt-base\".\"salesforce_opportunity_base\"\nwhere marketing_generator__c = '0035f00000G8KYcAAN'\ngroup by cancel_date__c\n),\n\nmarketing_cost as (\nselect\n    team,\n    month,\n    hom_cost,\n    ipr_cost,\n    copywriter,\n    dango_costs,\n    designer_costs,\n    paid_lead_cost,\n    data_contractor,\n    seo_lead_salary,\n    contractor_costs,\n    paid_agency_cost,\n    paid_support_cost,\n    project_management,\n    crowd_content_costs,\n    email_contractor_costs,\n    hubspot_contractor_costs\nfrom \"integrity-db\".\"prod_dbt-base\".\"marketing_cost_base\"\n),\n\nbase_dates as (\n    select\n        CAST(date as date)\n    from \"integrity-db\".\"google_sheets\".\"dates\"\n)\n\nselect \n    COALESCE(d.date, o.sold_date__c, b.timeperiod, h.converted_date, f.date_start, g.activity_date, c.cancel_date__c, m.month) AS activity_date,\n    COALESCE(g.googleads_cost, 0) AS googleads_cost,\n    COALESCE(g.googleads_impressions, 0) AS googleads_impressions,\n    COALESCE(g.googleads_clicks, 0) AS googleads_clicks,\n    COALESCE(b.bing_spend, 0) AS bing_spend,\n    COALESCE(b.bing_impressions, 0) AS bing_impressions,\n    COALESCE(b.bing_clicks, 0) AS bing_clicks,\n    COALESCE(h.hubspot_sent_emails, 0) AS hubspot_sent_emails,\n    COALESCE(h.hubspot_opened_emails, 0) AS hubspot_opened_emails,\n    COALESCE(h.hubspot_clicks, 0) AS hubspot_clicks,\n    COALESCE(h.hubspot_bounces, 0) AS hubspot_bounces,\n    COALESCE(h.hubspot_spam_reports, 0) AS hubspot_spam_reports,\n    COALESCE(f.facebook_impressions, 0) AS facebook_impressions,\n    COALESCE(f.facebook_reach, 0) AS facebook_reach,\n    COALESCE(f.facebook_spend, 0) AS facebook_spend, \n    COALESCE(f.facebook_clicks, 0) AS facebook_clicks,\n    COALESCE(f.facebook_unique_clicks, 0) AS facebook_unique_clicks,\n    COALESCE(o.total_won_opportunities, 0) AS total_won_opportunities,\n    COALESCE(o.total_won_points, 0) AS total_won_points,\n    COALESCE(o.paid_won_opportunities, 0) AS paid_won_opportunities,\n    COALESCE(o.paid_won_points, 0) AS paid_won_points,\n    COALESCE(o.earned_won_opportunities, 0) AS earned_won_opportunities,\n    COALESCE(o.earned_won_points, 0) AS earned_won_points,\n    COALESCE(o.owned_won_opportunities, 0) AS owned_won_opportunities,\n    COALESCE(o.owned_won_points, 0) AS owned_won_points,\n    COALESCE(o.google_won_opportunities, 0) AS google_won_opportunities,\n    COALESCE(o.google_won_points, 0) AS google_won_points,\n    COALESCE(o.microsoft_won_opportunities, 0) AS microsoft_won_opportunities,\n    COALESCE(o.microsoft_won_points, 0) AS microsoft_won_points,\n    COALESCE(o.email_won_opportunities, 0) AS email_won_opportunities,\n    COALESCE(o.email_won_points, 0) AS email_won_points,\n    COALESCE(c.total_cancelled_opportunities, 0) AS total_cancelled_opportunities,\n    COALESCE(c.total_cancelled_points, 0) AS total_cancelled_points,\n    m.team AS team,\n    m.month AS cost_month,\n    COALESCE(m.hom_cost, 0) AS hom_cost,\n    COALESCE(m.ipr_cost, 0) AS ipr_cost,\n    COALESCE(m.copywriter, 0) AS copywriter,\n    COALESCE(m.dango_costs, 0) AS dango_costs,\n    COALESCE(m.designer_costs, 0) AS designer_costs,\n    COALESCE(m.paid_lead_cost, 0) AS paid_lead_cost,\n    COALESCE(m.data_contractor, 0) AS data_contractor,\n    COALESCE(m.seo_lead_salary, 0) AS seo_lead_salary,\n    COALESCE(m.contractor_costs, 0) AS contractor_costs,\n    COALESCE(m.paid_agency_cost, 0) AS paid_agency_cost,\n    COALESCE(m.paid_support_cost, 0) AS paid_support_cost,\n    COALESCE(m.project_management, 0) AS project_management,\n    COALESCE(m.crowd_content_costs, 0) AS crowd_content_costs,\n    COALESCE(m.email_contractor_costs, 0) AS email_contractor_costs,\n    COALESCE(m.hubspot_contractor_costs, 0) AS hubspot_contractor_costs,\n    COALESCE(SUM(COALESCE(m.data_contractor, 0) + COALESCE(m.hubspot_contractor_costs, 0) + COALESCE(m.email_contractor_costs, 0)),0) as total_contractor_costs,\n    COALESCE(SUM(COALESCE(m.hom_cost, 0) + COALESCE(m.ipr_cost, 0) + COALESCE(m.copywriter, 0) + COALESCE(m.designer_costs, 0) + COALESCE(m.paid_lead_cost, 0) + COALESCE(m.seo_lead_salary, 0) + COALESCE(m.paid_support_cost, 0) + COALESCE(m.project_management, 0)),0) as operational_costs, \n    COALESCE(SUM(COALESCE(g.googleads_cost,0) + COALESCE(b.bing_spend,0) + COALESCE(f.facebook_spend,0)),0) as total_spend,\n    COALESCE(SUM(COALESCE(g.googleads_clicks,0) + COALESCE(b.bing_clicks,0) + COALESCE(f.facebook_clicks,0)),0) as total_clicks,\n    COALESCE(SUM(COALESCE(g.googleads_impressions,0) + COALESCE(b.bing_impressions,0) + COALESCE(f.facebook_impressions,0)),0) as total_impressions,\n    CASE\n        WHEN COALESCE(SUM(COALESCE(g.googleads_clicks,0) + COALESCE(b.bing_clicks,0) + COALESCE(f.facebook_clicks,0)),0) = 0 THEN 0\n        ELSE COALESCE(SUM(COALESCE(g.googleads_cost,0) + COALESCE(b.bing_spend,0) + COALESCE(f.facebook_spend,0)),0) / COALESCE(SUM(COALESCE(g.googleads_clicks,0) + COALESCE(b.bing_clicks,0) + COALESCE(f.facebook_clicks,0)),0)\n    END AS cost_per_click,\n    CASE\n        WHEN COALESCE(SUM(COALESCE(g.googleads_impressions,0) + COALESCE(b.bing_impressions,0) + COALESCE(f.facebook_impressions,0)),0) = 0 THEN 0\n        ELSE COALESCE(SUM(COALESCE(g.googleads_cost,0) + COALESCE(b.bing_spend,0) + COALESCE(f.facebook_spend,0)),0) / COALESCE(SUM(COALESCE(g.googleads_impressions,0) + COALESCE(b.bing_impressions,0) + COALESCE(f.facebook_impressions,0)),0)\n    END AS cost_per_impression,\n    CASE\n        WHEN COALESCE(SUM(o.total_won_opportunities), 0) = 0 THEN 0\n        ELSE COALESCE(SUM(COALESCE(g.googleads_cost,0) + COALESCE(b.bing_spend,0) + COALESCE(f.facebook_spend,0)),0) / COALESCE(SUM(o.total_won_opportunities), 0)\n    END AS cost_per_deal,\n    CASE\n        WHEN COALESCE(SUM(COALESCE(g.googleads_cost,0) + COALESCE(b.bing_spend,0) + COALESCE(f.facebook_spend,0)),0) = 0 THEN 0\n        ELSE (((SUM(o.total_won_points) * 100) / COALESCE(SUM(COALESCE(g.googleads_cost,0) + COALESCE(b.bing_spend,0) + COALESCE(f.facebook_spend,0)),0)) / 100)\n    END AS return_on_investment\nfrom base_dates as d \nleft outer join opportunity_sold as o on d.date = o.sold_date__c\nleft outer join hubspot as h on d.date = h.converted_date\nleft outer join bing_ads as b on b.timeperiod = d.date\nleft outer join facebook as f on f.date_start = d.date\nleft outer join google_ads as g on g.activity_date = d.date\nleft outer join opportunity_cancelled as c on c.cancel_date__c = d.date\nleft outer join marketing_cost as m on d.date = m.month\ngroup by 1,2,3,4,5,6,7,8,9,10,11,12,13,14,15,16,17,18,19,20,21,22,23,24,25,26,27,28,29,30,31,32,33,34,35,36,37,38,39,40,41,42,43,44,45,46,47,48,49,50", "relation_name": "\"integrity-db\".\"prod_dbt-intermediate\".\"marketing_intermediate\"", "batch_results": null}, {"status": "success", "timing": [{"name": "compile", "started_at": "2025-02-04T19:56:48.823641Z", "completed_at": "2025-02-04T19:56:48.829327Z"}, {"name": "execute", "started_at": "2025-02-04T19:56:48.829327Z", "completed_at": "2025-02-04T19:56:57.879733Z"}], "thread_id": "Thread-2 (worker)", "execution_time": 9.131715297698975, "adapter_response": {"_message": "SUCCESS", "rows_affected": -1}, "message": "SUCCESS", "failures": null, "unique_id": "model.integrity_energy_dbt.utility_lead_prod", "compiled": true, "compiled_code": "\n\nselect\n    *\nfrom \"integrity-db\".\"prod_dbt-intermediate\".\"utility_lead_intermediate\"", "relation_name": "\"integrity-db\".\"prod_dbt-mart\".\"utility_lead_prod\"", "batch_results": null}, {"status": "success", "timing": [{"name": "compile", "started_at": "2025-02-04T19:56:57.955618Z", "completed_at": "2025-02-04T19:56:57.961065Z"}, {"name": "execute", "started_at": "2025-02-04T19:56:57.961065Z", "completed_at": "2025-02-04T19:57:03.954620Z"}], "thread_id": "Thread-2 (worker)", "execution_time": 6.097368001937866, "adapter_response": {"_message": "SUCCESS", "rows_affected": -1}, "message": "SUCCESS", "failures": null, "unique_id": "model.integrity_energy_dbt.marketing_prod", "compiled": true, "compiled_code": "\n\nselect\n    *\nfrom \"integrity-db\".\"prod_dbt-intermediate\".\"marketing_intermediate\"\nwhere activity_date IS NOT NULL", "relation_name": "\"integrity-db\".\"prod_dbt-mart\".\"marketing_prod\"", "batch_results": null}, {"status": "success", "timing": [{"name": "compile", "started_at": "2025-02-04T19:56:50.546017Z", "completed_at": "2025-02-04T19:56:50.546017Z"}, {"name": "execute", "started_at": "2025-02-04T19:56:50.546017Z", "completed_at": "2025-02-04T19:57:09.591469Z"}], "thread_id": "Thread-4 (worker)", "execution_time": 19.11687421798706, "adapter_response": {"_message": "SUCCESS", "rows_affected": -1}, "message": "SUCCESS", "failures": null, "unique_id": "model.integrity_energy_dbt._1_fuzzy_data_clean", "compiled": true, "compiled_code": "\n\nWITH clean_data AS (\n    SELECT\n        LOWER(\n            TRIM(\n                REGEXP_REPLACE(\n                    REGEXP_REPLACE(\n                        REGEXP_REPLACE(\n                            lead_company,\n                            '\\\\b(inc|corp|corporation|ltd|llc|co|company|and)\\\\b',  -- Remove common suffixes\n                            ''\n                        ),\n                        '[^a-zA-Z]',  -- Remove any non-alphabetic characters (including numbers and special chars)\n                        ''\n                    ),\n                    '\\\\s',  -- Remove any spaces\n                    ''\n                )\n            )\n        ) AS fuzzy_match_company_key\n        ,LOWER(TRIM(REGEXP_REPLACE(REGEXP_REPLACE(lead_company, '[^a-zA-Z]', ''), '\\\\s', ''))) AS lead_company\n    FROM\n        \"integrity-db\".\"prod_dbt-intermediate\".\"lead_intermediate\"\n\n)\n\nSELECT\n    fuzzy_match_company_key\n    ,lead_company\n    ,CASE\n        WHEN fuzzy_match_company_key IS NULL OR fuzzy_match_company_key = ''\n        THEN 'z'\n        ELSE fuzzy_match_company_key\n    END AS fuzzy_match_key\n    ,RANK() OVER (\n        ORDER BY\n            fuzzy_match_company_key ASC\n    ) AS seq_nbr\nFROM\n    clean_data", "relation_name": "\"integrity-db\".\"prod_dbt-unification\".\"_1_fuzzy_data_clean\"", "batch_results": null}, {"status": "success", "timing": [{"name": "compile", "started_at": "2025-02-04T19:56:54.483077Z", "completed_at": "2025-02-04T19:56:54.483077Z"}, {"name": "execute", "started_at": "2025-02-04T19:56:54.483077Z", "completed_at": "2025-02-04T19:57:13.334190Z"}], "thread_id": "Thread-1 (worker)", "execution_time": 19.44641900062561, "adapter_response": {"_message": "SUCCESS", "rows_affected": -1}, "message": "SUCCESS", "failures": null, "unique_id": "model.integrity_energy_dbt.deal_prod", "compiled": true, "compiled_code": "\n\nselect\n    *\nfrom \"integrity-db\".\"prod_dbt-intermediate\".\"deal_intermediate\"", "relation_name": "\"integrity-db\".\"prod_dbt-mart\".\"deal_prod\"", "batch_results": null}, {"status": "success", "timing": [{"name": "compile", "started_at": "2025-02-04T19:56:50.560397Z", "completed_at": "2025-02-04T19:56:50.560397Z"}, {"name": "execute", "started_at": "2025-02-04T19:56:50.560397Z", "completed_at": "2025-02-04T19:57:13.850182Z"}], "thread_id": "Thread-3 (worker)", "execution_time": 23.3690984249115, "adapter_response": {"_message": "SUCCESS", "rows_affected": -1}, "message": "SUCCESS", "failures": null, "unique_id": "model.integrity_energy_dbt.lead_prod", "compiled": true, "compiled_code": "\n\nselect\n    *\nfrom \"integrity-db\".\"prod_dbt-intermediate\".\"lead_intermediate\"", "relation_name": "\"integrity-db\".\"prod_dbt-mart\".\"lead_prod\"", "batch_results": null}, {"status": "success", "timing": [{"name": "compile", "started_at": "2025-02-04T19:57:09.669044Z", "completed_at": "2025-02-04T19:57:09.673050Z"}, {"name": "execute", "started_at": "2025-02-04T19:57:09.673050Z", "completed_at": "2025-02-04T19:57:15.234586Z"}], "thread_id": "Thread-2 (worker)", "execution_time": 5.631600856781006, "adapter_response": {"_message": "SUCCESS", "rows_affected": -1}, "message": "SUCCESS", "failures": null, "unique_id": "model.integrity_energy_dbt._2_soundex", "compiled": true, "compiled_code": "\n\n--Soundex algortihm\n\nSELECT\n  fuzzy_match_key\n  ,lead_company\n  ,SOUNDEX(fuzzy_match_key) AS group_key\n  ,seq_nbr\nFROM\n  \"integrity-db\".\"prod_dbt-unification\".\"_1_fuzzy_data_clean\"", "relation_name": "\"integrity-db\".\"prod_dbt-unification\".\"_2_soundex\"", "batch_results": null}, {"status": "success", "timing": [{"name": "compile", "started_at": "2025-02-04T19:57:15.627040Z", "completed_at": "2025-02-04T19:57:15.627040Z"}, {"name": "execute", "started_at": "2025-02-04T19:57:15.627040Z", "completed_at": "2025-02-04T19:57:27.687429Z"}], "thread_id": "Thread-4 (worker)", "execution_time": 12.125617265701294, "adapter_response": {"_message": "SUCCESS", "rows_affected": -1}, "message": "SUCCESS", "failures": null, "unique_id": "model.integrity_energy_dbt._3_master_key", "compiled": true, "compiled_code": "\n\nSELECT\n    fuzzy_data.fuzzy_match_key,\n    fuzzy_data.group_key,\n    temp.lead_company AS master_key,\n    fuzzy_data.seq_nbr AS seq_nbr\nFROM\n    (SELECT\n         fuzzy_match_key,\n         group_key,\n         lead_company\n     FROM\n        (SELECT\n          fuzzy_match_key,\n          lead_company,\n          group_key,\n          ROW_NUMBER() OVER (PARTITION BY group_key ORDER BY group_key DESC) AS rn\n         FROM\n          \"integrity-db\".\"prod_dbt-unification\".\"_2_soundex\") t1\n     WHERE\n         rn = 1) AS temp,\n         \"integrity-db\".\"prod_dbt-unification\".\"_2_soundex\" AS fuzzy_data\nWHERE\n    temp.group_key = fuzzy_data.group_key", "relation_name": "\"integrity-db\".\"prod_dbt-unification\".\"_3_master_key\"", "batch_results": null}, {"status": "success", "timing": [{"name": "compile", "started_at": "2025-02-04T19:57:27.757272Z", "completed_at": "2025-02-04T19:57:27.764272Z"}, {"name": "execute", "started_at": "2025-02-04T19:57:27.765270Z", "completed_at": "2025-02-04T19:59:11.752318Z"}], "thread_id": "Thread-3 (worker)", "execution_time": 104.06266403198242, "adapter_response": {"_message": "SUCCESS", "rows_affected": -1}, "message": "SUCCESS", "failures": null, "unique_id": "model.integrity_energy_dbt._4_levenshtein", "compiled": true, "compiled_code": "\n\n-- Levenshtein with Filtering\n\nWITH ratio AS (\n\n    SELECT\n        fuzzy_match_key,\n        master_key,\n        group_key,\n        ((length(fuzzy_match_key) + length(master_key)) - fn_levenshtein_distance(fuzzy_match_key, master_key)) / (length(fuzzy_match_key) + length(master_key)) * 100 AS levenshtein_ratio,\n        seq_nbr\n    FROM\n        \"integrity-db\".\"prod_dbt-unification\".\"_3_master_key\"\n\n)\n\nSELECT\n    fuzzy_match_key,\n    master_key,\n    group_key,\n    levenshtein_ratio,\n    seq_nbr\nFROM\n    ratio\nWHERE\n    levenshtein_ratio >= 75.0", "relation_name": "\"integrity-db\".\"prod_dbt-unification\".\"_4_levenshtein\"", "batch_results": null}, {"status": "success", "timing": [{"name": "compile", "started_at": "2025-02-04T19:59:11.818698Z", "completed_at": "2025-02-04T19:59:11.832418Z"}, {"name": "execute", "started_at": "2025-02-04T19:59:11.832418Z", "completed_at": "2025-02-04T19:59:22.991873Z"}], "thread_id": "Thread-1 (worker)", "execution_time": 11.229209899902344, "adapter_response": {"_message": "SUCCESS", "rows_affected": -1}, "message": "SUCCESS", "failures": null, "unique_id": "model.integrity_energy_dbt._5_match_store", "compiled": true, "compiled_code": "\n\n--Match Store\n\nSELECT\n  group_key,\n  LISTAGG(seq_nbr, ',') WITHIN GROUP (ORDER BY seq_nbr) AS groups\nFROM\n  \"integrity-db\".\"prod_dbt-unification\".\"_4_levenshtein\"\nGROUP BY\n  group_key", "relation_name": "\"integrity-db\".\"prod_dbt-unification\".\"_5_match_store\"", "batch_results": null}, {"status": "success", "timing": [{"name": "compile", "started_at": "2025-02-04T19:59:11.832418Z", "completed_at": "2025-02-04T19:59:11.832418Z"}, {"name": "execute", "started_at": "2025-02-04T19:59:11.832418Z", "completed_at": "2025-02-04T19:59:31.737468Z"}], "thread_id": "Thread-4 (worker)", "execution_time": 19.983681201934814, "adapter_response": {"_message": "SUCCESS", "rows_affected": -1}, "message": "SUCCESS", "failures": null, "unique_id": "model.integrity_energy_dbt._6_lead_enriched", "compiled": true, "compiled_code": "\n\n--WITH aggregated_customers  AS (\n--\n--  SELECT\n--    lead_master_id\n--    ,MAX(lead_company) as lead_company\n--    ,MAX(lead_street) as lead_street\n--    ,MAX(LOWER(TRIM(lead_email))) as lead_email\n--    ,MAX(LOWER(TRIM(REGEXP_REPLACE(lead_phone, '[- ]', '')))) as lead_phone\n--    ,MAX(LOWER(TRIM(REGEXP_REPLACE(lead_lastname, '[^a-zA-Z]', '')))) as lead_lastname\n--    ,MAX(LOWER(TRIM(REGEXP_REPLACE(lead_firstname, '[^a-zA-Z]', '')))) as lead_firstname\n--  FROM\n--    \"integrity-db\".\"prod_dbt-mart\".\"lead_prod\"\n--  GROUP BY\n--    lead_master_id\n--\n--),\n\nWITH aggregated_customers  AS (\n\n  SELECT\n    lead_master_id\n    ,lead_company as lead_company\n    ,LOWER(\n        TRIM(\n            REGEXP_REPLACE(\n                REGEXP_REPLACE(\n                    REGEXP_REPLACE(\n                        lead_company,\n                        '\\\\b(inc|corp|corporation|ltd|llc|co|company|and)\\\\b',  -- Remove common suffixes\n                        ''\n                    ),\n                    '[^a-zA-Z]',  -- Remove any non-alphabetic characters (including numbers and special chars)\n                    ''\n                ),\n                '\\\\s',  -- Remove any spaces\n                ''\n            )\n        )\n    ) AS fuzzy_match_company_key\n    ,lead_street as lead_street\n    ,LOWER(TRIM(lead_email)) as lead_email\n    ,TRIM(REGEXP_REPLACE(lead_phone, '[- ]', '')) as lead_phone\n    ,LOWER(TRIM(REGEXP_REPLACE(lead_lastname, '[^a-zA-Z]', ''))) as lead_lastname\n    ,LOWER(TRIM(REGEXP_REPLACE(lead_firstname, '[^a-zA-Z]', ''))) as lead_firstname\n  FROM\n    \"integrity-db\".\"prod_dbt-mart\".\"lead_prod\"\n--  GROUP BY\n--    lead_master_id\n\n),\n\nadd_keys AS (\n\n  SELECT\n    lead_master_id\n    ,CASE\n        WHEN fuzzy_match_company_key IS NULL OR fuzzy_match_company_key = ''\n        THEN 'z'\n        ELSE fuzzy_match_company_key\n    END AS fuzzy_match_key\n    ,lead_company\n    ,lead_street\n    ,lead_email\n    ,lead_phone\n    ,lead_lastname\n    ,lead_firstname\n  FROM\n    aggregated_customers\n\n),\n\nadd_master_key AS (\n\n  SELECT\n    keys.lead_master_id\n    ,keys.fuzzy_match_key\n    ,unify.master_key\n    ,unify.group_key\n    ,unify.levenshtein_ratio\n    ,keys.lead_company\n    ,keys.lead_street\n    ,keys.lead_firstname\n    ,keys.lead_lastname\n    ,keys.lead_email\n    ,keys.lead_phone\n  FROM\n    add_keys AS keys\n    INNER JOIN \"integrity-db\".\"prod_dbt-unification\".\"_4_levenshtein\" AS unify\n      ON keys.fuzzy_match_key = unify.fuzzy_match_key\n\n)\n\nSELECT DISTINCT\n  lead_master_id\n--  ,fuzzy_match_key\n  ,master_key\n  ,group_key\n  ,levenshtein_ratio\n  ,lead_company\n  ,lead_street\n  ,lead_firstname\n  ,lead_lastname\n  ,lead_email\n  ,lead_phone\nFROM\n  add_master_key", "relation_name": "\"integrity-db\".\"prod_dbt-unification\".\"_6_lead_enriched\"", "batch_results": null}], "elapsed_time": 194.11941409111023, "args": {"exclude": [], "use_colors": true, "skip_nodes_if_on_run_start_fails": false, "invocation_command": "dbt run --select tag:daily", "select": ["tag:daily"], "require_resource_names_without_spaces": false, "static_parser": true, "quiet": false, "warn_error_options": {"include": [], "exclude": []}, "state_modified_compare_more_unrendered_values": false, "vars": {}, "print": true, "empty": false, "log_level_file": "debug", "use_colors_file": true, "partial_parse": true, "profiles_dir": "C:\\Users\\2ewol\\Documents\\Clients\\Integrity_Energy\\integrity-energy-dbt", "require_explicit_package_overrides_for_builtin_materializations": true, "log_format": "default", "which": "run", "defer": false, "log_file_max_bytes": 10485760, "favor_state": false, "show_resource_report": false, "cache_selected_only": false, "source_freshness_run_project_hooks": false, "write_json": true, "log_path": "C:\\Users\\2ewol\\Documents\\Clients\\Integrity_Energy\\integrity-energy-dbt\\logs", "macro_debugging": false, "populate_cache": true, "strict_mode": false, "state_modified_compare_vars": false, "introspect": true, "indirect_selection": "eager", "log_format_file": "debug", "version_check": true, "project_dir": "C:\\Users\\2ewol\\Documents\\Clients\\Integrity_Energy\\integrity-energy-dbt", "partial_parse_file_diff": true, "send_anonymous_usage_stats": true, "log_level": "info", "printer_width": 80}}