{"metadata": {"dbt_schema_version": "https://schemas.getdbt.com/dbt/run-results/v6.json", "dbt_version": "1.9.0b2", "generated_at": "2025-01-03T21:49:33.442340Z", "invocation_id": "fce16e40-8ee3-4164-aee1-1eed269eed91", "env": {}}, "results": [{"status": "success", "timing": [{"name": "compile", "started_at": "2025-01-03T21:47:04.863526Z", "completed_at": "2025-01-03T21:47:04.868794Z"}, {"name": "execute", "started_at": "2025-01-03T21:47:04.868794Z", "completed_at": "2025-01-03T21:47:15.404874Z"}], "thread_id": "Thread-1 (worker)", "execution_time": 10.616915225982666, "adapter_response": {"_message": "SUCCESS", "rows_affected": -1}, "message": "SUCCESS", "failures": null, "unique_id": "model.integrity_energy_dbt._1_fuzzy_data_clean", "compiled": true, "compiled_code": "\n\nWITH clean_data AS (\n    SELECT\n        LOWER(\n            TRIM(\n                REGEXP_REPLACE(\n                    REGEXP_REPLACE(\n                        REGEXP_REPLACE(\n                            lead_company,\n                            '\\\\b(inc|corp|corporation|ltd|llc|co|company|and)\\\\b',  -- Remove common suffixes\n                            ''\n                        ),\n                        '[^a-zA-Z]',  -- Remove any non-alphabetic characters (including numbers and special chars)\n                        ''\n                    ),\n                    '\\\\s',  -- Remove any spaces\n                    ''\n                )\n            )\n        ) AS fuzzy_match_company_key\n    FROM\n        \"integrity-db\".\"prod_dbt-intermediate\".\"lead_intermediate\"\n\n)\n\nSELECT\n    fuzzy_match_company_key,\n    CASE\n        WHEN fuzzy_match_company_key IS NULL OR fuzzy_match_company_key = ''\n        THEN 'z'\n        ELSE fuzzy_match_company_key\n    END AS fuzzy_match_key,\n    RANK() OVER (\n        ORDER BY\n            fuzzy_match_company_key ASC\n    ) AS seq_nbr\nFROM\n    clean_data", "relation_name": "\"integrity-db\".\"prod_dbt-unification\".\"_1_fuzzy_data_clean\"", "batch_results": null}, {"status": "success", "timing": [{"name": "compile", "started_at": "2025-01-03T21:47:15.486446Z", "completed_at": "2025-01-03T21:47:15.489447Z"}, {"name": "execute", "started_at": "2025-01-03T21:47:15.490447Z", "completed_at": "2025-01-03T21:47:17.673178Z"}], "thread_id": "Thread-3 (worker)", "execution_time": 2.266378402709961, "adapter_response": {"_message": "SUCCESS", "rows_affected": -1}, "message": "SUCCESS", "failures": null, "unique_id": "model.integrity_energy_dbt._2_soundex", "compiled": true, "compiled_code": "\n\n--Soundex algortihm\n\nSELECT\n  fuzzy_match_key,\n  SOUNDEX(fuzzy_match_company_key) AS group_key,\n  seq_nbr\nFROM\n  \"integrity-db\".\"prod_dbt-unification\".\"_1_fuzzy_data_clean\"", "relation_name": "\"integrity-db\".\"prod_dbt-unification\".\"_2_soundex\"", "batch_results": null}, {"status": "success", "timing": [{"name": "compile", "started_at": "2025-01-03T21:47:17.756829Z", "completed_at": "2025-01-03T21:47:17.760829Z"}, {"name": "execute", "started_at": "2025-01-03T21:47:17.760829Z", "completed_at": "2025-01-03T21:47:20.212551Z"}], "thread_id": "Thread-2 (worker)", "execution_time": 2.5348522663116455, "adapter_response": {"_message": "SUCCESS", "rows_affected": -1}, "message": "SUCCESS", "failures": null, "unique_id": "model.integrity_energy_dbt._3_master_key", "compiled": true, "compiled_code": "\n\nSELECT\n    fuzzy_data.fuzzy_match_key,\n    fuzzy_data.group_key,\n    temp.fuzzy_match_key AS master_key,\n    fuzzy_data.seq_nbr AS seq_nbr\nFROM\n    (SELECT\n         fuzzy_match_key,\n         group_key\n     FROM\n        (SELECT\n          fuzzy_match_key,\n          group_key,\n          ROW_NUMBER() OVER (PARTITION BY group_key ORDER BY group_key DESC) AS rn\n         FROM\n          \"integrity-db\".\"prod_dbt-unification\".\"_2_soundex\") t1\n     WHERE\n         rn = 1) AS temp,\n         \"integrity-db\".\"prod_dbt-unification\".\"_2_soundex\" AS fuzzy_data\nWHERE\n    temp.group_key = fuzzy_data.group_key", "relation_name": "\"integrity-db\".\"prod_dbt-unification\".\"_3_master_key\"", "batch_results": null}, {"status": "success", "timing": [{"name": "compile", "started_at": "2025-01-03T21:47:20.298461Z", "completed_at": "2025-01-03T21:47:20.298461Z"}, {"name": "execute", "started_at": "2025-01-03T21:47:20.298461Z", "completed_at": "2025-01-03T21:49:12.661697Z"}], "thread_id": "Thread-4 (worker)", "execution_time": 112.43561744689941, "adapter_response": {"_message": "SUCCESS", "rows_affected": -1}, "message": "SUCCESS", "failures": null, "unique_id": "model.integrity_energy_dbt._4_levenshtein", "compiled": true, "compiled_code": "\n\n-- Levenshtein with Filtering\n\nWITH ratio AS (\n\n    SELECT\n        fuzzy_match_key,\n        master_key,\n        group_key,\n        ((length(fuzzy_match_key) + length(master_key)) - fn_levenshtein_distance(fuzzy_match_key, master_key)) / (length(fuzzy_match_key) + length(master_key)) * 100 AS levenshtein_ratio,\n        seq_nbr\n    FROM\n        \"integrity-db\".\"prod_dbt-unification\".\"_3_master_key\"\n\n)\n\nSELECT\n    fuzzy_match_key,\n    master_key,\n    group_key,\n    levenshtein_ratio,\n    seq_nbr\nFROM\n    ratio\nWHERE\n    levenshtein_ratio >= 75.0", "relation_name": "\"integrity-db\".\"prod_dbt-unification\".\"_4_levenshtein\"", "batch_results": null}, {"status": "success", "timing": [{"name": "compile", "started_at": "2025-01-03T21:49:12.732035Z", "completed_at": "2025-01-03T21:49:12.739764Z"}, {"name": "execute", "started_at": "2025-01-03T21:49:12.740877Z", "completed_at": "2025-01-03T21:49:14.902769Z"}], "thread_id": "Thread-1 (worker)", "execution_time": 2.2462825775146484, "adapter_response": {"_message": "SUCCESS", "rows_affected": -1}, "message": "SUCCESS", "failures": null, "unique_id": "model.integrity_energy_dbt._5_match_store", "compiled": true, "compiled_code": "\n\n--Match Store\n\nSELECT\n  group_key,\n  LISTAGG(seq_nbr, ',') WITHIN GROUP (ORDER BY seq_nbr) AS groups\nFROM\n  \"integrity-db\".\"prod_dbt-unification\".\"_4_levenshtein\"\nGROUP BY\n  group_key", "relation_name": "\"integrity-db\".\"prod_dbt-unification\".\"_5_match_store\"", "batch_results": null}, {"status": "success", "timing": [{"name": "compile", "started_at": "2025-01-03T21:49:12.736038Z", "completed_at": "2025-01-03T21:49:12.739764Z"}, {"name": "execute", "started_at": "2025-01-03T21:49:12.743886Z", "completed_at": "2025-01-03T21:49:32.855512Z"}], "thread_id": "Thread-2 (worker)", "execution_time": 20.187039852142334, "adapter_response": {"_message": "SUCCESS", "rows_affected": -1}, "message": "SUCCESS", "failures": null, "unique_id": "model.integrity_energy_dbt._6_lead_enriched", "compiled": true, "compiled_code": "\n\n--WITH aggregated_customers  AS (\n--\n--  SELECT\n--    lead_master_id\n--    ,MAX(lead_company) as lead_company\n--    ,MAX(lead_street) as lead_street\n--    ,MAX(LOWER(TRIM(lead_email))) as lead_email\n--    ,MAX(LOWER(TRIM(REGEXP_REPLACE(lead_phone, '[- ]', '')))) as lead_phone\n--    ,MAX(LOWER(TRIM(REGEXP_REPLACE(lead_lastname, '[^a-zA-Z]', '')))) as lead_lastname\n--    ,MAX(LOWER(TRIM(REGEXP_REPLACE(lead_firstname, '[^a-zA-Z]', '')))) as lead_firstname\n--  FROM\n--    \"integrity-db\".\"prod_dbt-mart\".\"lead_prod\"\n--  GROUP BY\n--    lead_master_id\n--\n--),\n\nWITH aggregated_customers  AS (\n\n  SELECT\n    lead_master_id\n    ,lead_company as lead_company\n    ,LOWER(\n        TRIM(\n            REGEXP_REPLACE(\n                REGEXP_REPLACE(\n                    REGEXP_REPLACE(\n                        lead_company,\n                        '\\\\b(inc|corp|corporation|ltd|llc|co|company|and)\\\\b',  -- Remove common suffixes\n                        ''\n                    ),\n                    '[^a-zA-Z]',  -- Remove any non-alphabetic characters (including numbers and special chars)\n                    ''\n                ),\n                '\\\\s',  -- Remove any spaces\n                ''\n            )\n        )\n    ) AS fuzzy_match_company_key\n    ,lead_street as lead_street\n    ,LOWER(TRIM(lead_email)) as lead_email\n    ,TRIM(REGEXP_REPLACE(lead_phone, '[- ]', '')) as lead_phone\n    ,LOWER(TRIM(REGEXP_REPLACE(lead_lastname, '[^a-zA-Z]', ''))) as lead_lastname\n    ,LOWER(TRIM(REGEXP_REPLACE(lead_firstname, '[^a-zA-Z]', ''))) as lead_firstname\n  FROM\n    \"integrity-db\".\"prod_dbt-mart\".\"lead_prod\"\n--  GROUP BY\n--    lead_master_id\n\n),\n\nadd_keys AS (\n\n  SELECT\n    lead_master_id\n    ,CASE\n        WHEN fuzzy_match_company_key IS NULL OR fuzzy_match_company_key = ''\n        THEN 'z'\n        ELSE fuzzy_match_company_key\n    END AS fuzzy_match_key\n    ,lead_company\n    ,lead_street\n    ,lead_email\n    ,lead_phone\n    ,lead_lastname\n    ,lead_firstname\n  FROM\n    aggregated_customers\n\n),\n\nadd_master_key AS (\n\n  SELECT\n    keys.lead_master_id\n    ,keys.fuzzy_match_key\n    ,unify.master_key\n    ,unify.group_key\n    ,unify.levenshtein_ratio\n    ,keys.lead_company\n    ,keys.lead_street\n    ,keys.lead_firstname\n    ,keys.lead_lastname\n    ,keys.lead_email\n    ,keys.lead_phone\n  FROM\n    add_keys AS keys\n    INNER JOIN \"integrity-db\".\"prod_dbt-unification\".\"_4_levenshtein\" AS unify\n      ON keys.fuzzy_match_key = unify.fuzzy_match_key\n\n)\n\nSELECT DISTINCT\n  lead_master_id\n--  ,fuzzy_match_key\n  ,master_key\n  ,group_key\n  ,levenshtein_ratio\n  ,lead_company\n  ,lead_street\n  ,lead_firstname\n  ,lead_lastname\n  ,lead_email\n  ,lead_phone\nFROM\n  add_master_key", "relation_name": "\"integrity-db\".\"prod_dbt-unification\".\"_6_lead_enriched\"", "batch_results": null}], "elapsed_time": 150.71951985359192, "args": {"strict_mode": false, "vars": {}, "partial_parse": true, "state_modified_compare_vars": false, "use_colors": true, "cache_selected_only": false, "quiet": false, "write_json": true, "log_format": "default", "partial_parse_file_diff": true, "show_resource_report": false, "log_path": "C:\\Users\\2ewol\\Documents\\Clients\\Integrity_Energy\\integrity-energy-dbt\\logs", "favor_state": false, "print": true, "introspect": true, "macro_debugging": false, "source_freshness_run_project_hooks": false, "printer_width": 80, "log_file_max_bytes": 10485760, "warn_error_options": {"include": [], "exclude": []}, "log_level_file": "debug", "require_explicit_package_overrides_for_builtin_materializations": true, "exclude": [], "static_parser": true, "version_check": true, "select": ["tag:unification"], "log_format_file": "debug", "defer": false, "use_colors_file": true, "skip_nodes_if_on_run_start_fails": false, "require_resource_names_without_spaces": false, "indirect_selection": "eager", "profiles_dir": "C:\\Users\\2ewol\\Documents\\Clients\\Integrity_Energy\\integrity-energy-dbt", "project_dir": "C:\\Users\\2ewol\\Documents\\Clients\\Integrity_Energy\\integrity-energy-dbt", "send_anonymous_usage_stats": true, "empty": false, "populate_cache": true, "which": "run", "state_modified_compare_more_unrendered_values": false, "log_level": "info", "invocation_command": "dbt run --select tag:unification"}}